
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Map-making &#8212; LBS 0.13.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/asciinema-player_2.6.1.css" />
    <link rel="stylesheet" type="text/css" href="_static/asciinema-custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/contentui.css" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=1019fba8"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/asciinema-player_2.6.1.js"></script>
    <script src="_static/contentui.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'mapmaking';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="part6.html" />
    <link rel="prev" title="Data-reduction modules" href="part5.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">LBS 0.13.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="part1.html">
    Introduction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part2.html">
    Structure of the framework
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part3.html">
    Basic simulation modules
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part4.html">
    Systematic effects
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="part5.html">
    Data-reduction modules
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="part6.html">
    Tutorials
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="appendix.html">
    Appendices
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="installation.html">
    Installation
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="part1.html">
    Introduction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part2.html">
    Structure of the framework
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part3.html">
    Basic simulation modules
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part4.html">
    Systematic effects
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="part5.html">
    Data-reduction modules
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part6.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="appendix.html">
    Appendices
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="installation.html">
    Installation
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Map-making</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="part5.html" class="nav-link">Data-reduction modules</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Map-making</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="map-making">
<span id="mapmaking"></span><h1>Map-making<a class="headerlink" href="#map-making" title="Link to this heading">#</a></h1>
<p>The primary aim of the LiteBIRD Simulation Framework is to create
synthetic timestreams as if the real LiteBIRD acquired them.
The process of creating maps out of these timelines is
called <em>map-making</em> and it is strictly considered a data-analysis
task, not a simulation task. However, since most of the assessments on
the quality of a timestream can only be done on maps, the LiteBIRD
Simulation Framework provides some facilities to produce maps out of
timestreams. These maps are created using the <a class="reference external" href="https://en.wikipedia.org/wiki/HEALPix">Healpix</a> pixelization scheme and
saved in FITS files.</p>
<p>The framework provides the following solutions:</p>
<ol class="arabic simple">
<li><p>A <em>binner</em>, i.e., a simple map-maker that assumes that only
uncorrelated noise is present in the timelines.</p></li>
<li><p>A <em>destriper</em>, i.e., a more advanced map-maker that can remove the
effect of correlated instrumental noise from the timelines before
producing a map. We usually refer to correlated noise as 1/f
noise, and the purpose of the destriper is to estimate its
contribution and remove it from the timelines; then, a classical
<em>binner</em> is run over the cleaned timelines.</p></li>
<li><p>A wrapper that enables you to use the
<a class="reference external" href="https://github.com/hpc4cmb/toast">TOAST2</a> destriper. (To use
this, you must ensure that the package
<a class="reference external" href="https://pypi.org/project/toast/">toast</a> is installed.)</p></li>
<li><p>You can also use <a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a> to save TODs
and pointing information to disk and then manually call the <a class="reference external" href="https://arxiv.org/abs/astro-ph/0412517">Madam
map-maker</a>.</p></li>
</ol>
<p>In this chapter, we assume you have already created the timelines
to be used as input to the destriper. Here is a sample code
that creates a simple timeline containing white noise for two
detectors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">MT19937</span><span class="p">,</span> <span class="n">RandomState</span><span class="p">,</span> <span class="n">SeedSequence</span>

<span class="kn">import</span> <span class="nn">litebird_sim</span> <span class="k">as</span> <span class="nn">lbs</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">base_path</span><span class="o">=</span><span class="s2">&quot;destriper_output&quot;</span><span class="p">,</span>
    <span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">duration_s</span><span class="o">=</span><span class="mf">86400.0</span><span class="p">,</span>
    <span class="n">random_seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sim</span><span class="o">.</span><span class="n">set_scanning_strategy</span><span class="p">(</span>
    <span class="n">scanning_strategy</span><span class="o">=</span><span class="n">lbs</span><span class="o">.</span><span class="n">SpinningScanningStrategy</span><span class="p">(</span>
        <span class="n">spin_sun_angle_rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>  <span class="c1"># CORE-specific parameter</span>
        <span class="n">spin_rate_hz</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># Ditto</span>
        <span class="c1"># We use astropy to convert the period (4 days) in</span>
        <span class="c1"># seconds</span>
        <span class="n">precession_rate_hz</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">instr</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">InstrumentInfo</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;core&quot;</span><span class="p">,</span>
    <span class="n">spin_boresight_angle_rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">65</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># We create two detectors, whose polarization angles are separated by π/2</span>
<span class="n">sim</span><span class="o">.</span><span class="n">create_observations</span><span class="p">(</span>
    <span class="n">detectors</span><span class="o">=</span><span class="p">[</span>
        <span class="n">lbs</span><span class="o">.</span><span class="n">DetectorInfo</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;0A&quot;</span><span class="p">,</span> <span class="n">sampling_rate_hz</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
        <span class="n">lbs</span><span class="o">.</span><span class="n">DetectorInfo</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;0B&quot;</span><span class="p">,</span> <span class="n">sampling_rate_hz</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="n">lbs</span><span class="o">.</span><span class="n">quat_rotation_z</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">],</span>
    <span class="n">tod_dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>  <span class="c1"># Needed if you use the TOAST destriper</span>
    <span class="n">n_blocks_time</span><span class="o">=</span><span class="n">lbs</span><span class="o">.</span><span class="n">MPI_COMM_WORLD</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
    <span class="n">split_list_over_processes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Generate some white noise</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">RandomState</span><span class="p">(</span><span class="n">MT19937</span><span class="p">(</span><span class="n">SeedSequence</span><span class="p">(</span><span class="mi">123456789</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">curobs</span> <span class="ow">in</span> <span class="n">sim</span><span class="o">.</span><span class="n">observations</span><span class="p">:</span>
    <span class="n">curobs</span><span class="o">.</span><span class="n">tod</span> <span class="o">*=</span> <span class="mf">0.0</span>
    <span class="n">curobs</span><span class="o">.</span><span class="n">tod</span> <span class="o">+=</span> <span class="n">rs</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">curobs</span><span class="o">.</span><span class="n">tod</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>The paper <span id="id1">[<a class="reference internal" href="bibliography.html#id6" title="H. Kurki-Suonio, E. Keihänen, R. Keskitalo, T. Poutanen, A. -S. Sirviö, D. Maino, and C. Burigana. Destriping CMB temperature and polarization maps. A&amp;A, 506(3):1511-1539, November 2009. arXiv:0904.3623, doi:10.1051/0004-6361/200912361.">5</a>]</span> explains
the theory of binners and destripers. Our implementation
closely follows the terminology used in the paper. In
this chapter, we will refer to the paper as KS2009.</p>
<section id="binner">
<span id="mapmaking-binner"></span><h2>Binner<a class="headerlink" href="#binner" title="Link to this heading">#</a></h2>
<p>Once you have generated a set of observations, either on a single
process or distributed over several mpi processes, you can create a
simple binned map with the function <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a>. This function
takes one or more <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> objects and the Healpix
resolution of the output map (<code class="docutils literal notranslate"><span class="pre">nside</span></code>), and it produces a coadded map.
The algorithm assumes white noise and each detector gets weighted by
<span class="math notranslate nohighlight">\(1 / \text{NET}^2\)</span>. If the pointing information is not provided in the
observation, it can be passed through the optional argument <cite>pointings</cite>,
with a syntax similar to <a class="reference internal" href="map_scanning.html#litebird_sim.scan_map.scan_map_in_observations" title="litebird_sim.scan_map.scan_map_in_observations"><code class="xref py py-func docutils literal notranslate"><span class="pre">scan_map_in_observations()</span></code></a>.
The output map is in Galactic coordinates, but you can specify the
coordinate system you want via the parameter <cite>output_coordinates</cite>.
This is how it should be called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">make_binned_map</span><span class="p">(</span><span class="n">nside</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">observations</span><span class="o">=</span><span class="n">observations</span><span class="p">)</span>
<span class="n">healpy</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">binned_map</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>The function obtains pointing information from the <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a>
(either using the precomputed pointing or computed on the fly). As an
alternative, you can provide pointings as a list of numpy arrays.
The result is an instance of the class <a class="reference internal" href="#litebird_sim.mapmaking.BinnerResult" title="litebird_sim.mapmaking.BinnerResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">BinnerResult</span></code></a>
and contains both the I/Q/U maps and the covariance matrix.</p>
<p>Function <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a> has a high-level interface in the class
<a class="reference internal" href="simulations.html#litebird_sim.simulations.Simulation" title="litebird_sim.simulations.Simulation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Simulation</span></code></a> that bins the content of the observations into maps.
The syntax is identical to <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">make_binned_map</span><span class="p">(</span><span class="n">nside</span><span class="o">=</span><span class="n">nside</span><span class="p">)</span>
<span class="n">healpy</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">binned_map</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#litebird_sim.mapmaking.BinnerResult" title="litebird_sim.mapmaking.BinnerResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">BinnerResult</span></code></a> class contains the field <code class="docutils literal notranslate"><span class="pre">binned_map</span></code>,
which is a Healpix map containing the binned values of the samples.</p>
<p>Using a simple example, we now explain how the function calculates
the binned map. Suppose we measured just two pixels in the map with
only seven measurements. (These numbers are ridiculous, but in this
way, the matrices we will write will be more manageable!)</p>
<p>Each sample is associated with a direction in the sky (the <em>pointing
information</em>), but from the point of view of the binner, the only
quantity that matters is the pixel index in the map associated with
the pointing direction. In our example, the seven samples will measure
just two pixels in the sky with different attack (polarization) angles.
The following figure and table show how the seven TOD samples observe
the two pixels. The bars refer to the polarization angle of the detector.</p>
<figure class="align-default" id="id6">
<span id="todsamples-in-mapmaking-figure"></span><img alt="_images/destriper-tod-angles.svg" src="_images/destriper-tod-angles.svg" />
<figcaption>
<p><span class="caption-text">Toy-example of a TOD containing 7 samples.</span><a class="headerlink" href="#id6" title="Link to this image">#</a></p>
<div class="legend">
<p>The figure shows how the seven samples observe each of the two pixels
in the map. The thick bars represent the direction of the attack angle
ψ, which coincides with the polarization angle of the detector projected
on the center of the pixel.</p>
</div>
</figcaption>
</figure>
<div class="pst-scrollable-table-container"><span id="todsamples-in-mapmaking-table"></span><table class="table" id="id7">
<caption><span class="caption-text">Samples in the TOD, their polarization angle ψ, and the pixel they hit</span><a class="headerlink" href="#id7" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>#</p></th>
<th class="head"><p>ψ</p></th>
<th class="head"><p>Pixel</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>90°</p></td>
<td><p><img alt="pixel1" src="_images/destriper-pixel1.svg" /> (1)</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>30°</p></td>
<td><p><img alt="pixel1" src="_images/destriper-pixel1.svg" /> (1)</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>90°</p></td>
<td><p><img alt="pixel2" src="_images/destriper-pixel2.svg" /> (2)</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>15°</p></td>
<td><p><img alt="pixel2" src="_images/destriper-pixel2.svg" /> (2)</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>30°</p></td>
<td><p><img alt="pixel2" src="_images/destriper-pixel2.svg" /> (2)</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>45°</p></td>
<td><p><img alt="pixel2" src="_images/destriper-pixel2.svg" /> (2)</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>60°</p></td>
<td><p><img alt="pixel1" src="_images/destriper-pixel1.svg" /> (1)</p></td>
</tr>
</tbody>
</table>
</div>
<p>A fundamental quantity in KS2009 is the <em>pointing matrix</em> matrix
<span class="math notranslate nohighlight">\(P\)</span>: it is a <span class="math notranslate nohighlight">\((N_t, 3N_p)\)</span> matrix where <span class="math notranslate nohighlight">\(N_t\)</span>
is the number of samples in the TOD (7 in our case) and
<span class="math notranslate nohighlight">\(N_p\)</span> is the number of pixels observed by the TOD (2 in
our case). Thus, for our simple example <span class="math notranslate nohighlight">\(P\)</span> is</p>
<div class="math notranslate nohighlight">
\[\begin{split}P = \begin{pmatrix}
\textcolor{#002683}{1}&amp; \textcolor{#002683}{\cos90^\circ}&amp; \textcolor{#002683}{\sin90^\circ}&amp; 0&amp; 0&amp; 0\\
\textcolor{#002683}{1}&amp; \textcolor{#002683}{\cos30^\circ}&amp; \textcolor{#002683}{\sin30^\circ}&amp; 0&amp; 0&amp; 0\\
0&amp; 0&amp; 0&amp; \textcolor{#268300}{1}&amp; \textcolor{#268300}{\cos90^\circ}&amp; \textcolor{#268300}{\sin90^\circ}\\
0&amp; 0&amp; 0&amp; \textcolor{#268300}{1}&amp; \textcolor{#268300}{\cos15^\circ}&amp; \textcolor{#268300}{\sin15^\circ}\\
0&amp; 0&amp; 0&amp; \textcolor{#268300}{1}&amp; \textcolor{#268300}{\cos30^\circ}&amp; \textcolor{#268300}{\sin30^\circ}\\
0&amp; 0&amp; 0&amp; \textcolor{#268300}{1}&amp; \textcolor{#268300}{\cos45^\circ}&amp; \textcolor{#268300}{\sin45^\circ}\\
\textcolor{#002683}{1}&amp; \textcolor{#002683}{\cos60^\circ}&amp; \textcolor{#002683}{\sin60^\circ}&amp; 0&amp; 0&amp; 0
\end{pmatrix},\end{split}\]</div>
<p>where the number of rows matches the number of samples in the TOD (7), and
for each pixel there are three columns corresponding to I, Q, and U.</p>
<p>Enough samples must cover each pixel: there must be at least three
non-degenerate polarization angles to recover the three Stokes
parameters associated with it (I, Q, and U). KS2009 describes
how to compute them through the matrix
<span class="math notranslate nohighlight">\(M = P^T\cdot C_w^{-1}\cdot P\)</span>, where <span class="math notranslate nohighlight">\(C_w\)</span> is a diagonal
matrix with shape <span class="math notranslate nohighlight">\((N_t, N_t)\)</span>, where each element along the diagonal
is <span class="math notranslate nohighlight">\(\sigma^2\)</span>, the white-noise variance of the sample:</p>
<div class="math notranslate nohighlight">
\[\begin{split}C_w = \begin{pmatrix}
\sigma^2&amp; 0&amp; 0&amp; 0&amp; 0&amp; 0&amp; 0\\
0&amp; \sigma^2&amp; 0&amp; 0&amp; 0&amp; 0&amp; 0\\
0&amp; 0&amp; \sigma^2&amp; 0&amp; 0&amp; 0&amp; 0\\
0&amp; 0&amp; 0&amp; \sigma^2&amp; 0&amp; 0&amp; 0\\
0&amp; 0&amp; 0&amp; 0&amp; \sigma^2&amp; 0&amp; 0\\
0&amp; 0&amp; 0&amp; 0&amp; 0&amp; \sigma^2&amp; 0\\
0&amp; 0&amp; 0&amp; 0&amp; 0&amp; 0&amp; \sigma^2
\end{pmatrix}\end{split}\]</div>
<p>The square matrix <span class="math notranslate nohighlight">\(M = P^T\cdot C_w^{-1}\cdot P\)</span> has shape
<span class="math notranslate nohighlight">\((3 N_p, 3 N_p)\)</span>: each pixel in the map is associated to a
3×3 block along the diagonal:</p>
<div class="math notranslate nohighlight">
\[\begin{split}M = \begin{pmatrix}
\textcolor{#002683}{\frac3{\sigma^2}}&amp;
    \textcolor{#002683}{-\frac1{\sigma^2}}&amp;
    \textcolor{#002683}{\frac{\sqrt3}{\sigma^2}}&amp;
    0&amp; 0&amp; 0\\
\textcolor{#002683}{-\frac1{\sigma^2}}&amp;
    \textcolor{#002683}{\frac3{2\sigma^2}}&amp;
    \textcolor{#002683}{0}&amp;
    0&amp; 0&amp; 0\\
\textcolor{#002683}{\frac{\sqrt3}{\sigma^2}}&amp;
    \textcolor{#002683}{0}&amp;
    \textcolor{#002683}{\frac{3}{2\sigma^2}}&amp;
    0&amp; 0&amp; 0\\
0&amp; 0&amp; 0&amp;
    \textcolor{#268300}{\frac4{\sigma^2}}&amp;
    \textcolor{#268300}{\frac{\sqrt3 - 1}{2\sigma^2}}&amp;
    \textcolor{#268300}{\frac{\sqrt3 + 3}{2\sigma^2}}\\
0&amp; 0&amp; 0&amp;
    \textcolor{#268300}{\frac{\sqrt3 - 1}{2\sigma^2}}&amp;
    \textcolor{#268300}{\frac2{\sigma^2}}&amp;
    \textcolor{#268300}{\frac{\sqrt3}{2\sigma^2}}\\
0&amp; 0&amp; 0&amp;
    \textcolor{#268300}{\frac{\sqrt3 + 3}{2\sigma^2}}&amp;
    \textcolor{#268300}{\frac{\sqrt 3}{2\sigma^2}}&amp;
    \textcolor{#268300}{\frac2{\sigma^2}}
\end{pmatrix}\end{split}\]</div>
<p>If we assigned different values for <span class="math notranslate nohighlight">\(\sigma\)</span> to the
seven elements along the diagonal of <span class="math notranslate nohighlight">\(C_w\)</span>, then
the 3×3 subblocks of the <span class="math notranslate nohighlight">\(M\)</span> matrix would have changed
to reflect the fact that those samples with smaller
<span class="math notranslate nohighlight">\(\sigma\)</span> have a greater weight in determining the
value of the Stokes parameter.</p>
<p>Once we have the matrices <span class="math notranslate nohighlight">\(P\)</span>, <span class="math notranslate nohighlight">\(C_w\)</span>, and <span class="math notranslate nohighlight">\(M\)</span>,
determining the value of the three Stokes parameters I, Q, U for
each pixel is trivial. The signal <span class="math notranslate nohighlight">\(s\)</span> measured by a detector
is a function of <span class="math notranslate nohighlight">\(I\)</span>, <span class="math notranslate nohighlight">\(Q\)</span>, <span class="math notranslate nohighlight">\(U\)</span>, and the
polarization angle <span class="math notranslate nohighlight">\(\psi\)</span>:</p>
<div class="math notranslate nohighlight">
\[s = I + Q \cos2\psi + U\sin2\psi\]</div>
<p>and thus we can exploit the redundancy of the measurements per
each pixel (remember: at least three measurements per pixel with
non-degenerate angles!) by running a simple <span class="math notranslate nohighlight">\(\chi^2\)</span> minimization
assuming Gaussian noise. The result is the following:</p>
<div class="math notranslate nohighlight">
\[m = M^{-1}\cdot P^T\cdot C_w^{-1}\cdot y,\]</div>
<p>where <span class="math notranslate nohighlight">\(y\)</span> is a 7-element vector containing the TOD samples
<span class="math notranslate nohighlight">\(s_i\)</span> and <span class="math notranslate nohighlight">\(m\)</span> is a 6-element vector containing the
estimates of the Stokes parameters I, Q, and U for the two pixels
in the map according to the following order:</p>
<div class="math notranslate nohighlight">
\[m = \begin{pmatrix}I_1&amp; Q_1&amp; U_1&amp; I_2&amp; Q_2&amp; U_2\end{pmatrix}\]</div>
<p>The presence of the matrix <span class="math notranslate nohighlight">\(C_w^{-1}\)</span> scales
the value of each sample so that the ones affected by larger noise
will be made smaller; the <span class="math notranslate nohighlight">\(P^T\)</span> factor sums all the samples
in the TOD that fall within the same pixel, and finally <span class="math notranslate nohighlight">\(M^{-1}\)</span>
“solves” the linear system for the three parameters I, Q, and U per
each pixel.</p>
<p>Once the call to <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a> ends, the field <code class="docutils literal notranslate"><span class="pre">invnpp</span></code>
of the <a class="reference internal" href="#litebird_sim.mapmaking.BinnerResult" title="litebird_sim.mapmaking.BinnerResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">BinnerResult</span></code></a> object returned by the function
contains an array with shape <span class="math notranslate nohighlight">\((N_p, 3, 3)\)</span>, where each
3×3 block is the inverse of the sub-matrix <span class="math notranslate nohighlight">\(M_i\)</span> for the
<em>i</em>-th pixel.</p>
<section id="data-splits">
<h3>Data splits<a class="headerlink" href="#data-splits" title="Link to this heading">#</a></h3>
<p>The function <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a> is also able to provide data
splits both in time and in detector space. The time split is passed
through a string in the parameter <cite>time_split</cite>; the same applies for
<cite>detector_split</cite>. Currently, the supported time splits are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;full&quot;</span></code> (default): no split.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;first_half&quot;</span></code>: use the first half of the TOD.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;second_half&quot;</span></code>: use the second half of the TOD.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;odd&quot;</span></code>: use the odd samples of the TOD.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;even&quot;</span></code>: use the even samples of the TOD.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;yearX&quot;</span></code>: use the TOD samples relative to the X-th year of observation.
The X-th part must be an integer between 1 and 3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;surveyX&quot;</span></code>: assuming that a complete survey is performed in 6 months,
use the X-th survey. X must be an integer between 1 and 6.</p></li>
</ul>
<p>There are three supported options for the detector split:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;full&quot;</span></code> (default): no split is performed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;waferXXX&quot;</span></code>: use the detectors in the wafer XXX. The XXX part
must specify the wafer (e.g. “L00”, “M01”, or “H02”).</p></li>
</ul>
<p>The final data split will correspond to the combination of the two splits.</p>
<p>The function <a class="reference internal" href="#litebird_sim.mapmaking.check_valid_splits" title="litebird_sim.mapmaking.check_valid_splits"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_valid_splits()</span></code></a> will check whether the requested
split is part of the list above. If the split is not valid, the function
will raise a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>. In addition, it will check whether the requested
split is compatible with the observation duration and the detector
list. Thus, for example, if the observation lasts one year, the split <code class="docutils literal notranslate"><span class="pre">year2</span></code>
will raise an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>. Similarly, if some detector in the L00 wafer
does the observation, <code class="docutils literal notranslate"><span class="pre">waferL03</span></code> will also raise an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>.</p>
</section>
</section>
<section id="destriper">
<span id="mapmaking-destriper"></span><h2>Destriper<a class="headerlink" href="#destriper" title="Link to this heading">#</a></h2>
<p>If you know that your simulation contains 1/f noise, you should avoid using
the binner and instead employ a better map-making algorithm. With 1/f noise,
the hypothesis that the noise be white drops and the binning equation is no
longer valid.</p>
<p>The destriping algorithm is implemented by the <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a>,
functionally equivalent to <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a>. However, as
the algorithm it implements is more complex, you must provide more
information when calling it. Specifically, you should instantiate an
instance of the class <a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.DestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperParameters</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">DestriperParameters</span><span class="p">(</span>
    <span class="o">...</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">make_destriped_map</span><span class="p">(</span>
    <span class="n">nside</span><span class="o">=</span><span class="n">nside</span><span class="p">,</span>
    <span class="n">observations</span><span class="o">=</span><span class="n">observations</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">healpy</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">destriped_map</span><span class="p">)</span>
</pre></div>
</div>
<p>Pointing information is handled identically to <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a>.
The result is an instance of the class <a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.DestriperResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperResult</span></code></a>, which
is similar to <a class="reference internal" href="#litebird_sim.mapmaking.BinnerResult" title="litebird_sim.mapmaking.BinnerResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">BinnerResult</span></code></a> but it contains much more information.</p>
<p>Function <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a> has a high level interface in the class
<a class="reference internal" href="simulations.html#litebird_sim.simulations.Simulation" title="litebird_sim.simulations.Simulation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Simulation</span></code></a> that applies the destriper algorithm to all the
observations in the simulation.
The syntax is identical to <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">make_destriped_map</span><span class="p">(</span><span class="n">nside</span><span class="o">=</span><span class="n">nside</span><span class="p">)</span>
<span class="n">healpy</span><span class="o">.</span><span class="n">mollview</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">destriped_map</span><span class="p">)</span>
</pre></div>
</div>
<p>We will now explain how a destriper works and what the meaning of each
parameter in the classes <a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.DestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperParameters</span></code></a> and
<a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.DestriperResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperResult</span></code></a> is. Apart from KS2009, another source of information
is the file
<a class="reference external" href="https://github.com/litebird/litebird_sim/blob/master/test/test_destriper.py">test/test_destriper.py</a>:
it compares the results of the destriper with the analytical solution of the
simple 7-sample model we discuss here.</p>
<p>The idea of a destriper is to group consecutive samples in the same TOD into
different <em>baselines</em>. Each baseline must contain a number of samples such that
the noise within it will be roughly white; thus, the baseline should not contain
too many samples! A good rule of thumb is to make the time span covered by
one baseline shorter than the inverse of the knee frequency for that detector.
The destriper works by assuming that the effect of 1/f noise on all the samples
within the baselines is a purely additive factor; this is an approximation,
but for experiments like Planck, it has worked well.</p>
<figure class="align-default" id="id8">
<img alt="_images/destriper-baselines.svg" src="_images/destriper-baselines.svg" />
<figcaption>
<p><span class="caption-text">Baselines in a destriper</span><a class="headerlink" href="#id8" title="Link to this image">#</a></p>
<div class="legend">
<p>A destriper seeing the 13 samples in the figure could decide to group them
into two baselines: 7 within the first baseline, and 6 within the second
baseline. The level <span class="math notranslate nohighlight">\(a_i\)</span> of each baseline is represented by a dashed
horizontal line.</p>
</div>
</figcaption>
</figure>
<p>The purpose of the destriper is to model 1/f noise using the baselines and produce
a cleaned map. It does so by doing the following steps:</p>
<ol class="arabic simple">
<li><p>It estimates the value of the baselines by minimizing a <span class="math notranslate nohighlight">\(\chi^2\)</span>
function (more on this later);</p></li>
<li><p>It removes the value of the baselines from each sample in the TOD;</p></li>
<li><p>It applies a binning operation on the cleaned TOD, using the same equations
explained in the section <a class="reference internal" href="#mapmaking-binner"><span class="std std-ref">Binner</span></a>.</p></li>
</ol>
<p>To provide a concrete example of how the destriper works, we will resume the toy
TOD containing seven samples that we discussed in the section <a class="reference internal" href="#mapmaking-binner"><span class="std std-ref">Binner</span></a>.
We will group these samples into two baselines of 4 and 3 samples, respectively.</p>
<p>It’s easier to understand what the algorithm does if we play following the rules
of the destriper: instead of thinking of proper 1/f noise, let’s pretend that what
we have in the TOD are the <em>baselines</em>: constant values that last for
some time and are added to the samples in the TOD. How can the destriper understand
the level of each baseline in the figure above? The trick is easy to understand
if we recall Table <a class="reference internal" href="#todsamples-in-mapmaking-table"><span class="std std-ref">Samples in the TOD, their polarization angle ψ, and the pixel they hit</span></a>. Let’s consider the first
pixel: it was measured by the first two samples, then the detector moved to another
position in the sky (the second pixel), but it moved back to the first pixel just
while measuring the last sample in the TOD (#7). The point is that the first two samples
#1 and #2 belong to the first baseline, since it lasts 4 pixels, while sample #7 belongs
to the second one. Yet, once we take 1/f noise into account, the estimated I/Q/U
parameter for this pixel must agree. We can rewrite this problem as a <span class="math notranslate nohighlight">\(\chi^2\)</span>
minimization problem: the destriper looks for the values of the two baselines that
minimize the discrepancy in the values of the pixels as estimated by every sample in the TOD.</p>
<p>Apart from the standard matrices <span class="math notranslate nohighlight">\(C_w\)</span>, <span class="math notranslate nohighlight">\(P\)</span>, and <span class="math notranslate nohighlight">\(M\)</span>, the
destriper requires a new matrix <span class="math notranslate nohighlight">\(F,\)</span> whose shape is <span class="math notranslate nohighlight">\((N_t, N_b)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}F = \begin{pmatrix}
1&amp; 0\\
1&amp; 0\\
1&amp; 0\\
1&amp; 0\\
0&amp; 1\\
0&amp; 1\\
0&amp; 1
\end{pmatrix}\end{split}\]</div>
<p>Don’t be fooled by the fact that the number of columns is the same as the number
of pixels in the map: in this case, the number of columns corresponds to the
number of <em>baselines</em> in the TOD! The operator <span class="math notranslate nohighlight">\(F\)</span> tells which baseline
“owns” the samples in the TOD, and, as you can see, we are assigning
the first four samples to the first baseline and the last three samples to
the last baseline. Applying <span class="math notranslate nohighlight">\(F\)</span> to a set of <span class="math notranslate nohighlight">\(N_t\)</span> samples
(the TOD) produces a vector containing <span class="math notranslate nohighlight">\(N_b\)</span> samples (the baselines). As
it is always the case that <span class="math notranslate nohighlight">\(N_b \ll N_t,\)</span> this means that <span class="math notranslate nohighlight">\(F\)</span> is
a very tall and narrow matrix!</p>
<p>The purpose of <span class="math notranslate nohighlight">\(F\)</span> is to “project” the values of the two baselines
into a 7-element TOD:</p>
<div class="math notranslate nohighlight">
\[\begin{split}F \cdot \begin{pmatrix}a_1\\a_2\end{pmatrix} =
 \begin{pmatrix}
 a_1\\ a_1\\ a_1\\ a_1\\ a_2\\ a_2\\ a_2
 \end{pmatrix}.\end{split}\]</div>
<p>The transpose <span class="math notranslate nohighlight">\(F^T\)</span> represents a linear operator that takes a 7-element
TOD and sums up all the elements belonging to the same baseline:</p>
<div class="math notranslate nohighlight">
\[\begin{split}F^T \cdot \begin{pmatrix}
y_1\\ y_2\\ y_3\\ y_4\\ y_5\\ y_6\\ y_7
\end{pmatrix} =
\begin{pmatrix}y_1 + y_2 + y_3 + y_4\\ y_5 + y_6 + y_7\end{pmatrix}.\end{split}\]</div>
<p>At the basis of the destriper there is the operator <span class="math notranslate nohighlight">\(Z,\)</span> which is defined as
follows:</p>
<div class="math notranslate nohighlight">
\[Z = I - P\cdot M^{-1}\cdot P^T\cdot C_w^{-1}\]</div>
<p>(<span class="math notranslate nohighlight">\(I\)</span> is the identity operator), and it is applied to a TOD: <span class="math notranslate nohighlight">\(Z\cdot y\)</span>.
The purpose of the operator is to “clean up” the TOD from all the components that
are not white noise. It does so by creating a map (note the presence on the right
of the map-binning operator <span class="math notranslate nohighlight">\(M^{-1}\cdot P^T\cdot C_w^{-1}\)</span> we discussed
before) and then scanning the map back into a TOD (the last operator <span class="math notranslate nohighlight">\(P\)</span>
on the left of the map-binning operator). Because of the difference between
the identity operator <span class="math notranslate nohighlight">\(I\)</span> and this matrix, the result of this
“map-and-scan” operation is subtracted from the TOD sample.</p>
<p>The destriper estimates the vector of baselines <span class="math notranslate nohighlight">\(a\)</span> by solving iteratively
the following equation, which is the solution of a minimization problem on the
<span class="math notranslate nohighlight">\(\chi^2\)</span> we qualitatively discussed before:</p>
<div class="math notranslate nohighlight">
\[\left(F^T\cdot C_w^{-1}\cdot Z\cdot F\right) a = F^T\cdot C_w^{-1}\cdot Z\cdot y\]</div>
<p>This equation is of the form <span class="math notranslate nohighlight">\(Ax = b,\)</span> where <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are
known and <span class="math notranslate nohighlight">\(x\)</span> is the quantity to determine. (The symbol <span class="math notranslate nohighlight">\(A\)</span> is commonly
found in linear algebra textbooks, so we will switch to this notation even if
KS2009 uses <span class="math notranslate nohighlight">\(D\)</span>.) The solution would just be <span class="math notranslate nohighlight">\(x = A^{-1}b\)</span>, but
there are two problems with this formula:</p>
<ol class="arabic simple">
<li><p>Matrix <span class="math notranslate nohighlight">\(A\)</span> is too large to be inverted;</p></li>
<li><p>Matrix <span class="math notranslate nohighlight">\(A\)</span> is not invertible!</p></li>
</ol>
<p>The second point is alarming, and it might sound like an irrecoverable
problem. The fact that <span class="math notranslate nohighlight">\(\det A = 0\)</span> stems from the fact that the solution to
the destriping equation is not unique, as if <span class="math notranslate nohighlight">\(a\)</span> is a solution, then
<span class="math notranslate nohighlight">\(a + K\)</span> is still a solution for any scalar constant <span class="math notranslate nohighlight">\(K.\)</span> (Remember, the
purpose of the destriper is to make the many measurements for I/Q/U within each
pixel <em>consistent</em> once it subtracts the baselines and the consistency is the same
if it shifts all the baselines by the same amount!) We are looking for
a solution <span class="math notranslate nohighlight">\(a\)</span> that is orthogonal to the null space of <span class="math notranslate nohighlight">\(A\)</span>.</p>
<p>We can solve both problems by employing the fact that <span class="math notranslate nohighlight">\(A\)</span> is a symmetric
semi-definite matrix and thus employing the so-called
<a class="reference external" href="https://en.wikipedia.org/wiki/Conjugate_gradient_method">Conjugate Gradient (CG) method</a>,
which is able to produce a solution for the problem <span class="math notranslate nohighlight">\(Ax = b\)</span> even
if <span class="math notranslate nohighlight">\(A\)</span> is singular, because it simply minimizes the quantity <span class="math notranslate nohighlight">\(Ax - b\)</span>
without trying to invert <span class="math notranslate nohighlight">\(A\)</span>. If you are curious about the details of
the algorithm, a good pedagogical reference is <span id="id2">[<a class="reference internal" href="bibliography.html#id7" title="Jonathan R Shewchuk. An introduction to the conjugate gradient method without the agonizing pain. Technical Report, Carnegie Mellon University, USA, 1994.">2</a>]</span>.</p>
<p>The way the algorithm works is to start from a guess for <span class="math notranslate nohighlight">\(x\)</span> (the set of
baselines), which must be orthogonal to the null-space of <span class="math notranslate nohighlight">\(A\)</span>; in our
case, it is enough to require that the mean value of the first guess of the baselines
is zero, i.e., <span class="math notranslate nohighlight">\(\sum_i x_i = 0\)</span>. Starting from guess <span class="math notranslate nohighlight">\(x^{(0)},\)</span> the
algorithm produces a new guess <span class="math notranslate nohighlight">\(x^{(1)}\)</span> such that <span class="math notranslate nohighlight">\(r^{(1)} = Ax^{(1)} - b\)</span> is
closer to zero than <span class="math notranslate nohighlight">\(r^{(0)} = Ax^{(0)} - b\)</span>. The procedure keeps going until the
residual <span class="math notranslate nohighlight">\(r^{(n)} = Ax^{(n)} - b\)</span> is small enough, always satisfying the
fact that <span class="math notranslate nohighlight">\(\sum_i x_i^{(n)} = 0\)</span> for any <span class="math notranslate nohighlight">\(n.\)</span> Thus, the final solution
will have the property that the average value of the baselines will be zero.</p>
<p>The CG algorithm requires iterations to continue until the residuals <span class="math notranslate nohighlight">\(r^{(n)}\)</span>
are “small enough”. But how can we tell this? Vector <span class="math notranslate nohighlight">\(r^{(n)}\)</span> contains
<span class="math notranslate nohighlight">\(N_b\)</span> elements, corresponding to the residual for each baseline, and it might
be that some of the residuals are small and some are not. The most common way to
deal with this is to compute some norm over <span class="math notranslate nohighlight">\(r^{(n)}\)</span> to produce a
single scalar and then to check whether this value is below some threshold.
There are several possible definitions for the norm:</p>
<ol class="arabic simple">
<li><p>The standard <span class="math notranslate nohighlight">\(L_2\)</span> norm (Euclidean): <span class="math notranslate nohighlight">\(\left\|r^{(n)}\right\|^2\)</span>;</p></li>
<li><p>The <span class="math notranslate nohighlight">\(L_\infty\)</span> norm: <span class="math notranslate nohighlight">\(\max_i\left|r_i^{(n)}\right|\)</span>.</p></li>
</ol>
<p>Function <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a> adopts <span class="math notranslate nohighlight">\(L_\infty\)</span>: it is
stricter than <span class="math notranslate nohighlight">\(L_2\)</span>, because it does not wash out the
presence of a few large residuals even if all the others are negligible.</p>
<p>The convergence of the Conjugated Gradient can be controlled by the
following fields in the <a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.DestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperParameters</span></code></a> class:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">iter_max</span></code>: the maximum number of iterations, i.e., the upper limit for <span class="math notranslate nohighlight">\(n\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threshold</span></code>: the value to be reached by the <span class="math notranslate nohighlight">\(L_\infty\)</span> norm when
applied to the residuals <span class="math notranslate nohighlight">\(r^{(n)}\)</span>: if the norm is smaller than <code class="docutils literal notranslate"><span class="pre">threshold</span></code>,
then the CG algorithm stops.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples_per_baseline</span></code>: this can either be an integer, in which case it will
be used for <em>all</em> the baselines, or a list of 1D arrays, each containing the
length of each baseline for each observation passed through the parameter
<code class="docutils literal notranslate"><span class="pre">observations</span></code>. Note that if you provide an integer, it might be that not all
baselines will have exactly that length: it depends on whether the number
<span class="math notranslate nohighlight">\(N_t\)</span> of samples in the TOD is evenly divisible by <code class="docutils literal notranslate"><span class="pre">samples_per_baseline</span></code>
or not. The algorithm tries to make the number of elements per baseline as evenly
as possible.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_preconditioner</span></code>: if this flag is <code class="docutils literal notranslate"><span class="pre">True</span></code>, the preconditioning matrix
<span class="math notranslate nohighlight">\(F^T\cdot C_w^{-1}\cdot F\)</span> will be used with the CG algorithm. This
might speed up the convergence.</p></li>
</ul>
<p>Once the destriper has completed the process, the following fields in the
<a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.DestriperResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperResult</span></code></a> object can be inspected to check how the CG iterations
went:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">converged</span></code>: a Boolean flag telling whether the <code class="docutils literal notranslate"><span class="pre">threshold</span></code> was reached
(<code class="docutils literal notranslate"><span class="pre">True</span></code>) or not (<code class="docutils literal notranslate"><span class="pre">False</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">history_of_stopping_factors</span></code>: a list of values of the <span class="math notranslate nohighlight">\(L_\infty\)</span>
norm applied to the residuals <span class="math notranslate nohighlight">\(r^{(n)},\)</span> one per each iteration of
the CG algorithm. Inspecting those values might help in understanding if
the destriper was not able to converge because of a too small value of
<code class="docutils literal notranslate"><span class="pre">iter_max</span></code>.</p></li>
</ul>
<p>The baselines are saved in the field <code class="docutils literal notranslate"><span class="pre">baselines</span></code> of the <a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.DestriperResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperResult</span></code></a>
class; this is a list of 2D arrays, where each element in the list is
associated with one of the observations passed in the parameter <code class="docutils literal notranslate"><span class="pre">observations</span></code>. The
shape of each 2D arrays is <span class="math notranslate nohighlight">\((N_d, N_b),\)</span> where
<span class="math notranslate nohighlight">\(N_d\)</span> is the number of detectors for the observation and <span class="math notranslate nohighlight">\(N_b\)</span> is
the number of baselines. A visual representation of the memory layout of
the field <code class="docutils literal notranslate"><span class="pre">baselines</span></code> is shown in the following figure.</p>
<figure class="align-default" id="id9">
<img alt="_images/destriper-baselines-memory-layout.svg" src="_images/destriper-baselines-memory-layout.svg" />
<figcaption>
<p><span class="caption-text">Memory layout for baselines.</span><a class="headerlink" href="#id9" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The image assumes the baselines contain data for two detectors, A and B.
In the <strong>upper image</strong>, the baselines are shown as horizontal lines that span
the time range covered by the two (consecutive) observations. We use continuous
lines for the baselines of detector A and dashed lines for B.
Note that the number of baselines in the first <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> object
(5) differs from the number in the second object (3). The <strong>lower image</strong> offers
a visual representation of the layout of the <code class="docutils literal notranslate"><span class="pre">baselines</span></code> field in the class
<a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.DestriperResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperResult</span></code></a>: a Python list of two elements, each containing 2D
arrays with shape <span class="math notranslate nohighlight">\((N_d, N_b)\)</span>. The <em>i</em>-th row of each 2D array contains
the baselines for the <em>i</em>-th detector.</p>
<p>The field <code class="docutils literal notranslate"><span class="pre">baseline_errors</span></code> has the same memory layout as <code class="docutils literal notranslate"><span class="pre">baselines</span></code>
and contains a rough estimate of the error per each baseline, assuming that
the noise in the baselines is not correlated. (Unrealistic!) Finally,
the field <code class="docutils literal notranslate"><span class="pre">baseline_lengths</span></code> is a list of 1D integer arrays of <span class="math notranslate nohighlight">\(N_b\)</span>
elements containing the number of samples in each baseline; it should match
the value provided in the field <code class="docutils literal notranslate"><span class="pre">samples_per_baseline</span></code> in the class
<a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.DestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperParameters</span></code></a>.</p>
<p>Once the destriper has computed a solution for the destriping equation, you
can ask to remove the baselines from the TOD using one of the functions
<a class="reference internal" href="#litebird_sim.mapmaking.remove_baselines_from_tod" title="litebird_sim.mapmaking.remove_baselines_from_tod"><code class="xref py py-func docutils literal notranslate"><span class="pre">remove_baselines_from_tod()</span></code></a> or <a class="reference internal" href="#litebird_sim.mapmaking.remove_destriper_baselines_from_tod" title="litebird_sim.mapmaking.remove_destriper_baselines_from_tod"><code class="xref py py-func docutils literal notranslate"><span class="pre">remove_destriper_baselines_from_tod()</span></code></a>.</p>
<p>You can save the results of the destriper using the function
<a class="reference internal" href="#litebird_sim.mapmaking.save_destriper_results" title="litebird_sim.mapmaking.save_destriper_results"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_destriper_results()</span></code></a> and load them back again with the
<a class="reference internal" href="#litebird_sim.mapmaking.load_destriper_results" title="litebird_sim.mapmaking.load_destriper_results"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_destriper_results()</span></code></a>. Note that if you are running your code
using MPI, you should call both functions on <em>all</em> the MPI processes,
and the number of processes should be the same between the two calls.</p>
<p>In addition, func:<cite>.make_destriped_map</cite> can accept a custom set of baselines
as input. The destriper will skip the CG iterations and proceed directly to
the map-making step if these have the correct dimensions.</p>
<section id="how-the-n-obs-matrix-is-stored">
<h3>How the N_obs matrix is stored<a class="headerlink" href="#how-the-n-obs-matrix-is-stored" title="Link to this heading">#</a></h3>
<p>The destriper uses a different method to store the matrix <span class="math notranslate nohighlight">\(M\)</span> in
memory. As the 3×3 sub-blocks of this matrix need to be inverted often
during the CG process, the function <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a> decomposes
each block using <a class="reference external" href="https://en.wikipedia.org/wiki/Cholesky_decomposition">Cholesky decomposition</a>: each 3×3
matrix <span class="math notranslate nohighlight">\(M_i\)</span> associated with the pixels in the map is decomposed
into</p>
<div class="math notranslate nohighlight">
\[M_i = L_i L_i^T,\]</div>
<p>where <span class="math notranslate nohighlight">\(L\)</span> is a lower-triangular matrix, and only the nonzero
coefficients of the matrix are saved. The advantages are twofold:</p>
<ol class="arabic simple">
<li><p>Less memory is required;</p></li>
<li><p>Calculating the inverse <span class="math notranslate nohighlight">\(M^{-1}\)</span> is faster and more accurate.</p></li>
</ol>
<p>The fields are saved in an instance of the class <code class="xref py py-class docutils literal notranslate"><span class="pre">NobsMatrix</span></code>,
which contains the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nobs_matrix</span></code> is a 2D array of shape <span class="math notranslate nohighlight">\((N_p, 6)\)</span>, containing
the nonzero components of the <span class="math notranslate nohighlight">\(N_p\)</span> matrices;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">valid_pixel</span></code> is a 1D Boolean array containing <span class="math notranslate nohighlight">\(N_p\)</span> elements:
each of them is <code class="docutils literal notranslate"><span class="pre">True</span></code> if the corresponding matrix <span class="math notranslate nohighlight">\(M_i\)</span>
was invertible (i.e., it was observed with at least three non-degenerate
attack angles), <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_cholesky</span></code> is a flag that tells whether <code class="docutils literal notranslate"><span class="pre">nobs_matrix</span></code> contains
the nonzero coefficients of the many <span class="math notranslate nohighlight">\(L_i\)</span> matrices or the
lower triangular part of <span class="math notranslate nohighlight">\(M_i\)</span>. After a successful call to
<a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a>, this should always be <code class="docutils literal notranslate"><span class="pre">True</span></code>: it is
set to <code class="docutils literal notranslate"><span class="pre">False</span></code> during the execution of the destriper but updated
to <code class="docutils literal notranslate"><span class="pre">True</span></code> before the CG iteration starts.</p></li>
</ul>
<p>Given that it is often useful to have access to matrix <span class="math notranslate nohighlight">\(M^{-1}\)</span>,
the method <code class="xref py py-meth docutils literal notranslate"><span class="pre">NobsMatrix.get_invnpp()</span></code> computes this inverse as
a 3D array with shape <span class="math notranslate nohighlight">\((N_pix, 3, 3)\)</span>, where the first index
runs over all the pixels and the last two dimensions are used to
store the value of <span class="math notranslate nohighlight">\(M_i^{-1}\)</span>.</p>
</section>
<section id="id3">
<h3>Data splits<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>Similarly to the function <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a>,
<a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a> too can provide data splits both in time
and detector space. Given that the splits are implemented in the same
way, refer to the documentation of <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a> for more
details.</p>
<p>The difference is that each split is applied to the TOD before the
destriper runs. Therefore, the destriper will only use the samples
within the split to compute the baselines.</p>
</section>
</section>
<section id="toast2-destriper">
<h2>TOAST2 Destriper<a class="headerlink" href="#toast2-destriper" title="Link to this heading">#</a></h2>
<p>If you install the <a class="reference external" href="https://pypi.org/project/toast/">toast</a> using <code class="docutils literal notranslate"><span class="pre">pip</span></code>,
you can use the <a class="reference external" href="https://github.com/hpc4cmb/toast">TOAST2</a> destriper within
the LiteBIRD Simulation Framework. As TOAST is an optional dependency, you
should check if the Framework was able to detect its presence:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">litebird_sim</span> <span class="k">as</span> <span class="nn">lbs</span>

<span class="k">if</span> <span class="n">lbs</span><span class="o">.</span><span class="n">TOAST_ENABLED</span><span class="p">:</span>
    <span class="c1"># It&#39;s ok to use TOAST</span>
    <span class="o">...</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># TOAST is not present, do something else</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The procedure to use the TOAST2 destriper is similar to the steps required to
call the internal destriper: you must create a
<a class="reference internal" href="#litebird_sim.mapmaking.ExternalDestriperParameters" title="litebird_sim.mapmaking.ExternalDestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExternalDestriperParameters</span></code></a> object that specifies which input
parameters (apart from the timelines) should be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">ExternalDestriperParameters</span><span class="p">(</span>
    <span class="n">nside</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
    <span class="n">return_hit_map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">return_binned_map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">return_destriped_map</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The parameters we use here are the resolution of the output map
(<code class="docutils literal notranslate"><span class="pre">nside=16</span></code>), and the kind of results that must be returned:
specifically, we are looking here for the <em>hit map</em> (i.e., a map that
specifies how many samples were observed while the detector was
looking at a specific pixel), the <em>binned map</em> (the same map that
would be produced by the <em>binner</em>, see above), and the <em>destriped map</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The TOAST destriper only works with timelines containing 64-bit
floating point numbers. As the default data type for timelines
created by <code class="docutils literal notranslate"><span class="pre">sim.create_observations</span></code> is a 32-bit float, if you
plan to run the destriper you should pass the flag
<code class="docutils literal notranslate"><span class="pre">tod_dtype=np.float64</span></code> to <code class="docutils literal notranslate"><span class="pre">sim.create_observations</span></code> (see the
code above), otherwise <code class="docutils literal notranslate"><span class="pre">destripe</span></code> will create an internal copy of
the TOD converted in 64-bit floating-point numbers, which is
usually a waste of space.</p>
</div>
<p>To run the TOAST2 destriper, you simply call
<code class="xref py py-func docutils literal notranslate"><span class="pre">destripe_with_toast2()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">destripe_with_toast2</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is an instance of the class <code class="xref py py-class docutils literal notranslate"><span class="pre">Toast2DestriperResult</span></code> and
contains the three maps we have asked above (hit map, binned map,
destriped map).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike the internal destriper, TOAST2 does not return information
about the convergence of the CG algorithm, and it is <em>not</em> granted
that the norm used to estimate the stopping factor is the same
as the one calculated by the internal destriper. Therefore, please
avoid comparing the stopping factors of the two destripers!</p>
</div>
</section>
<section id="saving-files-for-madam">
<h2>Saving files for Madam<a class="headerlink" href="#saving-files-for-madam" title="Link to this heading">#</a></h2>
<p>The function <a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a> takes a <a class="reference internal" href="simulations.html#litebird_sim.simulations.Simulation" title="litebird_sim.simulations.Simulation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Simulation</span></code></a>
object, a list of detectors and a output path (the default is a subfolder of
the output path of the simulation) and saves a set of files in it:</p>
<ol class="arabic simple">
<li><p>Pointing information, saved as FITS files;</p></li>
<li><p>TOD samples, saved as FITS files;</p></li>
<li><p>A so-called «simulation file», named <code class="docutils literal notranslate"><span class="pre">madam.sim</span></code>;</p></li>
<li><p>A so-called «parameter file», named <code class="docutils literal notranslate"><span class="pre">madam.par</span></code>.</p></li>
</ol>
<p>These files are ready to be used with the Madam map-maker; you just need
to pass the parameter file <code class="docutils literal notranslate"><span class="pre">madam.par</span></code> to one of the executables provided
by Madam (the other ones are referenced by the parameter file). For instance,
the following command will compute the amount of memory needed to run Madam:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ inputcheck madam.par
</pre></div>
</div>
<p>The following command will run Madam:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ madam madam.par
</pre></div>
</div>
<p>Of course, in a realistic situation you want to run <code class="docutils literal notranslate"><span class="pre">madam</span></code> using MPI,
so you should call <code class="docutils literal notranslate"><span class="pre">mpiexec</span></code>, <code class="docutils literal notranslate"><span class="pre">mpirun</span></code>, or something similar.</p>
<section id="creating-several-maps-with-madam">
<h3>Creating several maps with Madam<a class="headerlink" href="#creating-several-maps-with-madam" title="Link to this heading">#</a></h3>
<p>There are cases where you want to create several maps out of
one simulation. A common case is when you simulate several
components to be put in the TOD and store them in different
fields within each <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">create_observations</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="k">for</span> <span class="n">cur_obs</span> <span class="ow">in</span> <span class="n">sim</span><span class="o">.</span><span class="n">observations</span><span class="p">:</span>
    <span class="c1"># We&#39;ll include several components in the signal:</span>
    <span class="c1"># CMB, white noise, 1/f noise, and dipole</span>
    <span class="n">cur_obs</span><span class="o">.</span><span class="n">wn_tod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">cur_obs</span><span class="o">.</span><span class="n">tod</span><span class="p">)</span>
    <span class="n">cur_obs</span><span class="o">.</span><span class="n">oof_tod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">cur_obs</span><span class="o">.</span><span class="n">tod</span><span class="p">)</span>
    <span class="n">cur_obs</span><span class="o">.</span><span class="n">cmb_tod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">cur_obs</span><span class="o">.</span><span class="n">tod</span><span class="p">)</span>
    <span class="n">cur_obs</span><span class="o">.</span><span class="n">dip_tod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">cur_obs</span><span class="o">.</span><span class="n">tod</span><span class="p">)</span>

    <span class="c1"># Now fill each of the *_tod fields appropriately</span>
</pre></div>
</div>
<p>In cases like this, it is often useful to generate several
sets of maps that include different subsets of the components:</p>
<ol class="arabic simple">
<li><p>A map including just the CMB and white noise;</p></li>
<li><p>A map including CMB, white noise and 1/f, but not the dipole;</p></li>
<li><p>A map including all the components.</p></li>
</ol>
<p>You could of course call <a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a> three
times, but this would be a waste of space because you would end
up with three identical copies of the FITS file containing the
pointings, and the last set of FITS files would contain the same
components that were saved for the first two maps.
(Remember, <a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a> saves both the
pointings and the TODs!)</p>
<p>A trick to avoid wasting so much space is to save the FITS files
only once, including <em>all</em> the TOD components, and then call
<a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a> again for each other map using
<code class="docutils literal notranslate"><span class="pre">save_pointings=False</span></code> and <code class="docutils literal notranslate"><span class="pre">save_tods=False</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This code will generate *three* sets of Madam files:</span>
<span class="c1"># - One including the CMB and white noise</span>
<span class="c1"># - One including 1/f as well</span>
<span class="c1"># - The last one will include the dipole too</span>
<span class="n">save_files</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Iterate over all the maps we want to produce. For each of</span>
<span class="c1"># them we specify the name of the subfolder where the Madam</span>
<span class="c1"># files will be saved and the list of components to include</span>
<span class="k">for</span> <span class="p">(</span><span class="n">subfolder</span><span class="p">,</span> <span class="n">components_to_bin</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;cmb+wn&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;wn_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;cmb_tod&quot;</span><span class="p">]),</span>
    <span class="p">(</span><span class="s2">&quot;cmb+wn+1f&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;wn_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;oof_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;cmb_tod&quot;</span><span class="p">]),</span>
    <span class="p">(</span><span class="s2">&quot;cmb+wn+1f+dip&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;wn_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;oof_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;cmb_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;dip_tod&quot;</span><span class="p">]),</span>
<span class="p">]:</span>
    <span class="n">save_simulation_for_madam</span><span class="p">(</span>
        <span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="n">madam_subfolder_name</span><span class="o">=</span><span class="n">subfolder</span><span class="p">,</span>
        <span class="n">components</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cmb_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;wn_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;oof_tod&quot;</span><span class="p">,</span> <span class="s2">&quot;dipole_tod&quot;</span><span class="p">],</span>
        <span class="n">components_to_bin</span><span class="o">=</span><span class="n">components_to_bin</span><span class="p">,</span>
        <span class="n">save_pointings</span><span class="o">=</span><span class="n">save_files</span><span class="p">,</span>
        <span class="n">save_tods</span><span class="o">=</span><span class="n">save_files</span><span class="p">,</span>
     <span class="p">)</span>

     <span class="c1"># Set this to False for all the following iterations (maps)</span>
     <span class="n">save_files</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>It is important that the <cite>components</cite> parameter in the call to
<a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a> list <em>all</em> the components, even
if you ask Madam not to use them in the first and second maps. The reason
is that the function uses this parameter to create a «map» of the
components as they are supposed to appear in the FITS files; for
example, the <code class="docutils literal notranslate"><span class="pre">cmb_tod</span></code> field is the <em>third</em> in each TOD file, but this
would not be apparent while producing the first map, where it is the
<em>second</em> in the list of components that must be used. The <code class="docutils literal notranslate"><span class="pre">.par</span></code>
file will list the components that need to be used to
create the map, so it will not be confused if the TOD FITS files
contain more components than needed. (This is a neat feature
of Madam.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To understand how this kind of stuff works, it is useful to
recap how Madam works, as the possibility to reuse TODs for
different maps is linked to the fact that Madam requires
<em>two</em> files to be run: the <em>parameter file</em> and the <em>simulation
file</em>.</p>
<p>The <em>simulation file</em> represents a «map» of the content of a
set of FITS files. A simulation file includes no information
about the map-making process; it just tells how many FITS
files to read and what is inside each.</p>
<p>The <em>parameter file</em> tells Madam how to create the maps. You
can ask Madam to skip parts of the TODs in the parameter file.
For example, you do not want to include the dipole in the output map.</p>
<p>When you call <a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a>, the
<cite>components</cite> parameter is used to build the <em>simulation file</em>:
thus, if you plan to build more than one map out of the same
set of components, you want to have the very same simulation
files because they «describe» what’s in the FITS files. This
is the reason why we passed the same value to <cite>components</cite>
every time we called <a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a>.</p>
<p>However, when we create the three <em>parameter files</em>, each of them
differs in the list of components that need to be included.
If you inspect the three files <code class="docutils literal notranslate"><span class="pre">cmb+wn/madam.par</span></code>,
<code class="docutils literal notranslate"><span class="pre">cmb+wn+1f/madam.par</span></code>, and <code class="docutils literal notranslate"><span class="pre">cmb+wn+1f+dip/madam.par</span></code>, you
will see that they only differ for the following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cmb+wn/madam.par</span>
<span class="n">tod_1</span> <span class="o">=</span> <span class="n">wn_tod</span>
<span class="n">tod_2</span> <span class="o">=</span> <span class="n">cmb_tod</span>

<span class="c1"># cmb+wn+1f/madam.par</span>
<span class="n">tod_1</span> <span class="o">=</span> <span class="n">wn_tod</span>
<span class="n">tod_2</span> <span class="o">=</span> <span class="n">oof_tod</span>
<span class="n">tod_3</span> <span class="o">=</span> <span class="n">cmb_tod</span>

<span class="c1"># cmb+wn+1f+dip/madam.par</span>
<span class="n">tod_1</span> <span class="o">=</span> <span class="n">wn_tod</span>
<span class="n">tod_2</span> <span class="o">=</span> <span class="n">oof_tod</span>
<span class="n">tod_3</span> <span class="o">=</span> <span class="n">cmb_tod</span>
<span class="n">tod_4</span> <span class="o">=</span> <span class="n">dip_tod</span>
</pre></div>
</div>
<p>That’s it. The lines with <code class="docutils literal notranslate"><span class="pre">tod_*</span></code> are enough to
do all the magic to build the three maps.</p>
</div>
<p>Of course, once the three directories <code class="docutils literal notranslate"><span class="pre">cmb+wn</span></code>, <code class="docutils literal notranslate"><span class="pre">cmb+wn+1f</span></code>, and
<code class="docutils literal notranslate"><span class="pre">cmb+wn+1f+dip</span></code> are created, Madam will run successfully only in
the first one, <code class="docutils literal notranslate"><span class="pre">cmb+wn</span></code>. The reason is that only that directory
includes the pointing and TOD FITS files! But if you are saving data
on a filesystem that supports <a class="reference external" href="https://en.wikipedia.org/wiki/Symbolic_link">symbolic links</a>, you can use them to
make the files appear in the other directories too. For instance, the
following commands will create them directly from a Unix shell (Bash,
Sh, Zsh):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>ln<span class="w"> </span>-srv<span class="w"> </span>cmb+wn/*.fits<span class="w"> </span>cmb+wn+1f
ln<span class="w"> </span>-srv<span class="w"> </span>cmb+wn/*.fits<span class="w"> </span>cmb+wn+1f+dip
</pre></div>
</div>
<p>(The <code class="docutils literal notranslate"><span class="pre">-s</span></code> flag asks to create <em>soft</em> links, the <code class="docutils literal notranslate"><span class="pre">-r</span></code> flag requires
paths to be relative, and <code class="docutils literal notranslate"><span class="pre">-v</span></code> makes <code class="docutils literal notranslate"><span class="pre">ln</span></code> be more verbose.)</p>
<p>If you want a fully authomatic procedure, you can create the symbolic
links in Python, taking advantage of the fact that
<a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a> returns a dictionary containing the
information needed to do this programmatically:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First map</span>
<span class="n">params1</span> <span class="o">=</span> <span class="n">save_simulation_for_madam</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="c1"># Second map</span>
<span class="n">params2</span> <span class="o">=</span> <span class="n">save_simulation_for_madam</span><span class="p">(</span>
    <span class="n">sim</span><span class="p">,</span>
    <span class="n">params</span><span class="p">,</span>
    <span class="n">madam_subfolder_name</span><span class="o">=</span><span class="s2">&quot;madam2&quot;</span><span class="p">,</span>
    <span class="n">save_pointings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">save_tods</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Caution: you want to do this only within the first MPI process!</span>
<span class="k">if</span> <span class="n">litebird_sim</span><span class="o">.</span><span class="n">MPI_COMM_WORLD</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">source_file</span><span class="p">,</span> <span class="n">dest_file</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">params1</span><span class="p">[</span><span class="s2">&quot;tod_files&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">params1</span><span class="p">[</span><span class="s2">&quot;pointing_files&quot;</span><span class="p">],</span>
        <span class="n">params2</span><span class="p">[</span><span class="s2">&quot;tod_files&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">params2</span><span class="p">[</span><span class="s2">&quot;pointing_files&quot;</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="c1"># This is a Path object associated with the symlink that we</span>
        <span class="c1"># want to create</span>
        <span class="n">source_file_path</span> <span class="o">=</span> <span class="n">source_file</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
        <span class="n">dest_file_path</span> <span class="o">=</span> <span class="n">dest_file</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>

        <span class="n">dest_file_path</span><span class="o">.</span><span class="n">symlink_to</span><span class="p">(</span><span class="n">source_file_path</span><span class="p">)</span>
</pre></div>
</div>
<p>You can include this snippet of code in the script that calls
<a class="reference internal" href="#litebird_sim.madam.save_simulation_for_madam" title="litebird_sim.madam.save_simulation_for_madam"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a>, so that the procedure will
be 100% automated.</p>
</section>
</section>
<section id="module-litebird_sim.mapmaking">
<span id="api-reference"></span><h2>API reference<a class="headerlink" href="#module-litebird_sim.mapmaking" title="Link to this heading">#</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.BinnerResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">BinnerResult</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binned_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invnpp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinate_system</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoordinateSystem</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">CoordinateSystem.Ecliptic</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.mapmaking.BinnerResult" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Result of a call to the <a class="reference internal" href="#litebird_sim.mapmaking.make_binned_map" title="litebird_sim.mapmaking.make_binned_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a> function</p>
<p>This dataclass has the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">binned_map</span></code>: Healpix map containing the binned value for each pixel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">invnpp</span></code>: inverse of the covariance matrix element for each
pixel in the map. It is an array of shape <cite>(12 * nside * nside, 3, 3)</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coordinate_system</span></code>: the coordinate system of the output maps
(a <code class="xref py py-class docutils literal notranslate"><span class="pre">CoordinateSistem</span></code> object)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">components</span></code>: list of components included in the map, by default
only the field <code class="docutils literal notranslate"><span class="pre">tod</span></code> is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">detector_split</span></code>: detector split of the binned map</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time_split</span></code>: time split of the binned map</p></li>
</ul>
<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.BinnerResult.binned_map">
<span class="sig-name descname"><span class="pre">binned_map</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Any</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.BinnerResult.binned_map" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.BinnerResult.components">
<span class="sig-name descname"><span class="pre">components</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.BinnerResult.components" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.BinnerResult.coordinate_system">
<span class="sig-name descname"><span class="pre">coordinate_system</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">CoordinateSystem</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#litebird_sim.mapmaking.BinnerResult.coordinate_system" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.BinnerResult.detector_split">
<span class="sig-name descname"><span class="pre">detector_split</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'full'</span></em><a class="headerlink" href="#litebird_sim.mapmaking.BinnerResult.detector_split" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.BinnerResult.invnpp">
<span class="sig-name descname"><span class="pre">invnpp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Any</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.BinnerResult.invnpp" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.BinnerResult.time_split">
<span class="sig-name descname"><span class="pre">time_split</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'full'</span></em><a class="headerlink" href="#litebird_sim.mapmaking.BinnerResult.time_split" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperParameters">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">DestriperParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_coordinate_system</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoordinateSystem</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">CoordinateSystem.Galactic</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples_per_baseline</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iter_max</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-07</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_preconditioner</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.mapmaking.DestriperParameters" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Parameters used by the function <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a></p>
<p>The class is used to tell the destriper how to solve the map-making
equation. The fields are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nside</span></code> (integer, power of two): resolution of the output map</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_coordinate_system</span></code> (<code class="xref py py-class docutils literal notranslate"><span class="pre">CoordinateSystem</span></code>): the
coordinate system of the output map</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples_per_baseline</span></code> (integer): how many consecutive samples
in the TOD must be assigned to the same baseline. If <code class="docutils literal notranslate"><span class="pre">None</span></code>,
the destriper algorithm is skipped and a simple binning will
be done.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iter_max</span></code> (integer): maximum number of iterations for the
Conjugate Gradient</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threshold</span></code> (float): minimum value of the discrepancy between
the estimated baselines and the baselines deduced by the
destriped map. The lower this value, the better the map
produced by the destriper</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_preconditioner</span></code> (Boolean): if <code class="docutils literal notranslate"><span class="pre">True</span></code>, use the preconditioned
conjugate gradient algorithm. If <code class="docutils literal notranslate"><span class="pre">False</span></code> do not use the
preconditioner. (The latter is probably useful only to debug the
code.)</p></li>
</ul>
<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperParameters.iter_max">
<span class="sig-name descname"><span class="pre">iter_max</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">100</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperParameters.iter_max" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperParameters.output_coordinate_system">
<span class="sig-name descname"><span class="pre">output_coordinate_system</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">CoordinateSystem</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperParameters.output_coordinate_system" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperParameters.samples_per_baseline">
<span class="sig-name descname"><span class="pre">samples_per_baseline</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">100</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperParameters.samples_per_baseline" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperParameters.threshold">
<span class="sig-name descname"><span class="pre">threshold</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1e-07</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperParameters.threshold" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperParameters.use_preconditioner">
<span class="sig-name descname"><span class="pre">use_preconditioner</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperParameters.use_preconditioner" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">DestriperResult</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.destriper.DestriperParameters"><span class="pre">DestriperParameters</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">nside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hit_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">binned_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nobs_matrix_cholesky</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">NobsMatrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinate_system</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoordinateSystem</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselines</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline_errors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline_lengths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stopping_factor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">history_of_stopping_factors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">destriped_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">converged</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">elapsed_time_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bytes_in_temporary_buffers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Result of a call to <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a></p>
<p>The fields <cite>baselines</cite>, <cite>baseline_lengths</cite>, <cite>stopping_factors</cite>,
<cite>destriped_map</cite>, and <cite>converged</cite> are only relevant if you actually
used the destriper; otherwise, they will be set to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>If you are running several MPI processes, keep in mind that the fields
<cite>hit_map</cite>, <cite>binned_map</cite>, <cite>destriped_map</cite>, <cite>nobs_matrix_cholesky</cite>,
and <cite>bytes_in_temporary_buffers</cite> contain the <em>global</em> map, but
<cite>baselines</cite> and <cite>baseline_lengths</cite> only refer to the TODs within
the <em>current</em> MPI process.</p>
<p>List of fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">params</span></code>: an instance of the class <a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.DestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperParameters</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nside</span></code>: the resolution of the Healpix maps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hit_map</span></code>: a map of scalar values, each representing the sum
of weights per pixel (normalized over the σ of each detector).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">binned_map</span></code>: the binned map (i.e., <em>without</em> subtracting the
1/f baselines estimated by the destriper).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nobs_matrix_cholesky</span></code>: an instance of the class
<code class="xref py py-class docutils literal notranslate"><span class="pre">NobsMatrix</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coordinate_system</span></code>: the coordinate system of the maps
<code class="docutils literal notranslate"><span class="pre">hit_map</span></code>, <code class="docutils literal notranslate"><span class="pre">binned_map</span></code>, and <code class="docutils literal notranslate"><span class="pre">destriped_map</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">baselines</span></code>: a Python list of NumPy arrays (one per each
observation passed to the destriper) containing the value
of the baselines.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">baseline_errors</span></code>: a Python list of NumPy arrays (one per
each observation passed to the destriper) containing an
optimistic estimate of the error per each baseline. This error
is estimated assuming that there is no correlation between
baselines, which is only a rough approximation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">baseline_lengths</span></code>: a Python list of NumPy arrays (one per
each observation passed to the destriper) containing the
number of TOD samples per each baseline.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stopping_factor</span></code>: the maximum residual for the destriping
solution stored in the field <cite>baselines</cite>. It is an assessment
of the quality of the solution found by the destriper: the
lower, the better.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">history_of_stopping_factors</span></code>: list of stopping factors
computed by the iterative algorithm. This list should ideally
be monothonically decreasing, as this means that the destriping
algorithm was able to converge to the correct solution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">converged</span></code>: a Boolean flag telling whether the destriper
was able to achieve the desired accuracy (the value of
<code class="docutils literal notranslate"><span class="pre">params.threshold</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">elapsed_time_s</span></code>: the elapsed time spent by the function
<a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes_in_temporary_buffers</span></code>: the number of bytes allocated
internally by the destriper for temporary buffers.</p></li>
</ul>
<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.baseline_errors">
<span class="sig-name descname"><span class="pre">baseline_errors</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.baseline_errors" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.baseline_lengths">
<span class="sig-name descname"><span class="pre">baseline_lengths</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.baseline_lengths" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.baselines">
<span class="sig-name descname"><span class="pre">baselines</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.baselines" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.binned_map">
<span class="sig-name descname"><span class="pre">binned_map</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.binned_map" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.bytes_in_temporary_buffers">
<span class="sig-name descname"><span class="pre">bytes_in_temporary_buffers</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.bytes_in_temporary_buffers" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.components">
<span class="sig-name descname"><span class="pre">components</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.components" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.converged">
<span class="sig-name descname"><span class="pre">converged</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.converged" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.coordinate_system">
<span class="sig-name descname"><span class="pre">coordinate_system</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">CoordinateSystem</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.coordinate_system" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.destriped_map">
<span class="sig-name descname"><span class="pre">destriped_map</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.destriped_map" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.detector_split">
<span class="sig-name descname"><span class="pre">detector_split</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'full'</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.detector_split" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.elapsed_time_s">
<span class="sig-name descname"><span class="pre">elapsed_time_s</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.elapsed_time_s" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.history_of_stopping_factors">
<span class="sig-name descname"><span class="pre">history_of_stopping_factors</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.history_of_stopping_factors" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.hit_map">
<span class="sig-name descname"><span class="pre">hit_map</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.hit_map" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.nobs_matrix_cholesky">
<span class="sig-name descname"><span class="pre">nobs_matrix_cholesky</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">NobsMatrix</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.nobs_matrix_cholesky" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.nside">
<span class="sig-name descname"><span class="pre">nside</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.nside" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.params">
<span class="sig-name descname"><span class="pre">params</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.destriper.DestriperParameters"><span class="pre">DestriperParameters</span></a></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.params" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.stopping_factor">
<span class="sig-name descname"><span class="pre">stopping_factor</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.stopping_factor" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.DestriperResult.time_split">
<span class="sig-name descname"><span class="pre">time_split</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'full'</span></em><a class="headerlink" href="#litebird_sim.mapmaking.DestriperResult.time_split" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">ExternalDestriperParameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">512</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinate_system</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoordinateSystem</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">CoordinateSystem.Ecliptic</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nnz</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline_length_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">60.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iter_max</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file_prefix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'lbs_'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_hit_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_binned_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_destriped_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_npp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_invnpp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_rcond</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Parameters used by the TOAST/Madam mapmakers to produce a map.</p>
<p>The list of fields in this dataclass is the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nside</span></code>: the NSIDE parameter used to create the maps</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coordinate_system</span></code>: an instance of the <code class="xref py py-class docutils literal notranslate"><span class="pre">CoordinateSystem</span></code> enum.
It specifies if the map must be created in ecliptic (default) or
galactic coordinates.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nnz</span></code>: number of components per pixel. The default is 3 (I/Q/U).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">baseline_length_s</span></code>: length of the baseline for 1/f noise in seconds.
The default is 60.0 s.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iter_max</span></code>: maximum number of iterations. The default is 100</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_file_prefix</span></code>: prefix to be used for the filenames of the
Healpix FITS maps saved in the output directory. The default
is <code class="docutils literal notranslate"><span class="pre">lbs_</span></code>.</p></li>
</ul>
<p>The following Boolean flags specify which maps should be returned
by the function <code class="xref py py-func docutils literal notranslate"><span class="pre">destripe()</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">return_hit_map</span></code>: return the hit map (number of hits per
pixel)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_binned_map</span></code>: return the binned map (i.e., the map with
no baselines removed).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_destriped_map</span></code>: return the destriped map. If pure
white noise is present in the timelines, this should be the same
as the binned map.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_npp</span></code>: return the map of the white noise covariance per
pixel. It contains the following fields: <code class="docutils literal notranslate"><span class="pre">II</span></code>, <code class="docutils literal notranslate"><span class="pre">IQ</span></code>, <code class="docutils literal notranslate"><span class="pre">IU</span></code>,
<code class="docutils literal notranslate"><span class="pre">QQ</span></code>, <code class="docutils literal notranslate"><span class="pre">QU</span></code>, and <code class="docutils literal notranslate"><span class="pre">UU</span></code> (in this order).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_invnpp</span></code>: return the map of the inverse covariance per
pixel. It contains the following fields: <code class="docutils literal notranslate"><span class="pre">II</span></code>, <code class="docutils literal notranslate"><span class="pre">IQ</span></code>, <code class="docutils literal notranslate"><span class="pre">IU</span></code>,
<code class="docutils literal notranslate"><span class="pre">QQ</span></code>, <code class="docutils literal notranslate"><span class="pre">QU</span></code>, and <code class="docutils literal notranslate"><span class="pre">UU</span></code> (in this order).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_rcond</span></code>: return the map of condition numbers.</p></li>
</ul>
<p>The default is to only return the destriped map.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.baseline_length_s">
<span class="sig-name descname"><span class="pre">baseline_length_s</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">60.0</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.baseline_length_s" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.coordinate_system">
<span class="sig-name descname"><span class="pre">coordinate_system</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">CoordinateSystem</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.coordinate_system" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.iter_max">
<span class="sig-name descname"><span class="pre">iter_max</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">100</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.iter_max" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.nnz">
<span class="sig-name descname"><span class="pre">nnz</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.nnz" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.nside">
<span class="sig-name descname"><span class="pre">nside</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">512</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.nside" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.output_file_prefix">
<span class="sig-name descname"><span class="pre">output_file_prefix</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'lbs_'</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.output_file_prefix" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.return_binned_map">
<span class="sig-name descname"><span class="pre">return_binned_map</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_binned_map" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.return_destriped_map">
<span class="sig-name descname"><span class="pre">return_destriped_map</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_destriped_map" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.return_hit_map">
<span class="sig-name descname"><span class="pre">return_hit_map</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_hit_map" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.return_invnpp">
<span class="sig-name descname"><span class="pre">return_invnpp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_invnpp" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.return_npp">
<span class="sig-name descname"><span class="pre">return_npp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_npp" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.ExternalDestriperParameters.return_rcond">
<span class="sig-name descname"><span class="pre">return_rcond</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_rcond" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.check_valid_splits">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">check_valid_splits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">observations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector_splits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_splits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.mapmaking.check_valid_splits" title="Link to this definition">#</a></dt>
<dd><p>Check if the splits are valid</p>
<p>For each observation in the list, check if the detector and time splits
are valid.
In particular, the compatibility between the detectors in each observation
and the desired split in detector domain is checked. On the other hand, this
assess whether the desired time split fits inside the duration of the
observation (when this applies).
If the splits are not compatible with the input data, an error is raised.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>observations</strong> (list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Observations</span></code>) – <p>observations to be mapped.
They are required to have the following attributes as arrays</p>
<ul>
<li><dl class="simple">
<dt><cite>pointings</cite>: the pointing information (in radians) for each tod</dt><dd><p>sample. It must be a tensor with shape <code class="docutils literal notranslate"><span class="pre">(N_d,</span> <span class="pre">N_t,</span> <span class="pre">3)</span></code>,
with <code class="docutils literal notranslate"><span class="pre">N_d</span></code> number of detectors and <code class="docutils literal notranslate"><span class="pre">N_t</span></code> number of
samples in the TOD.</p>
</dd>
</dl>
</li>
<li><p>any attribute listed in <cite>components</cite> (by default, <cite>tod</cite>) and
containing the TOD(s) to be binned together.</p></li>
</ul>
<p>If the observations are distributed over some communicator(s), they
must share the same group processes.
If pointings and psi are not included in the observations, they can
be provided through an array (or a list of arrays) of dimension
(Ndetectors x Nsamples x 3), containing theta, phi and psi</p>
</p></li>
<li><p><strong>detector_splits</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – <p>detector-domain splits
used to produce maps.</p>
<ul>
<li><p>”full”: every detector in the observation will be used;</p></li>
<li><dl class="simple">
<dt>”waferXXX”: the mapmaking will be performed on the intersection</dt><dd><p>of the detectors specified in the input and the detectors specified
in the detector_split.
The wafer must be specified in the format “waferXXX”. The valid values
for “XXX” are all the 3-digits strings corresponding to the wafers
in the LITEBIRD focal plane (e.g. L00, M01, H02).</p>
</dd>
</dl>
</li>
</ul>
</p></li>
<li><p><strong>time_splits</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>List</em><em>[</em><em>str</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – <p>time-domain splits
used to produce maps. This defaults to “full” indicating that every
sample in the observation will be used. In addition, the user can specify
a string, or a list of strings, to indicate a subsample of the observation
to be used:</p>
<ul>
<li><p>”full”: every sample in the observation will be used;</p></li>
<li><dl class="simple">
<dt>”first_half” and/or “second_half”: the first and/or second half of the</dt><dd><p>observation will be used;</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>”odd” and/or “even”: the odd and/or even samples in the observation</dt><dd><p>will be used;</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>”yearX”: the samples in the observation will be</dt><dd><p>used according to the year they belong to (relative to the
starting time). The valid values for “X” are [“1”, “2”, “3”].</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>”surveyX”: the samples in the observation will be used according</dt><dd><p>to the requested survey. In this context, a survey is taken to
be complete in 6 months, thus the valid values for “X” are
[“1”, “2”, “3”, “4”, “5”, “6”].</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.destriper_log_callback">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">destriper_log_callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stopping_factor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#litebird_sim.mapmaking.destriper_log_callback" title="Link to this definition">#</a></dt>
<dd><p>A function called by <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a> for every CG iteration</p>
<p>This function has the purpose to produce a visual feedback while the destriper
is running the (potentially long) Conjugated Gradient iteration.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.load_destriper_results">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">load_destriper_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">folder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_dest_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_base_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.destriper.DestriperResult"><span class="pre">DestriperResult</span></a></span></span><a class="headerlink" href="#litebird_sim.mapmaking.load_destriper_results" title="Link to this definition">#</a></dt>
<dd><p>Load the results of a call to <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a> from disk</p>
<p>This function complements <a class="reference internal" href="#litebird_sim.mapmaking.save_destriper_results" title="litebird_sim.mapmaking.save_destriper_results"><code class="xref py py-func docutils literal notranslate"><span class="pre">save_destriper_results()</span></code></a>.
It re-creates an object of type <a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.DestriperResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperResult</span></code></a> from a
set of FITS files. If you are calling this function from multiple
MPI processes, you must ensure that it is called by <em>every</em> MPI
process at the same time, and that the number of MPI processes is
the same that was used when the data were saved. (The function checks
for this and halts its execution if the condition is not satisfied.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>folder</strong> – The folder containing the FITS files to load</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new <a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.DestriperResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperResult</span></code></a> object</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.make_binned_map">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">make_binned_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointings</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hwp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="hwp.html#litebird_sim.hwp.HWP" title="litebird_sim.hwp.HWP"><span class="pre">HWP</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_coordinate_system</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">CoordinateSystem</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">CoordinateSystem.Galactic</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_split</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'full'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#litebird_sim.mapmaking.BinnerResult" title="litebird_sim.mapmaking.binner.BinnerResult"><span class="pre">BinnerResult</span></a></span></span><a class="headerlink" href="#litebird_sim.mapmaking.make_binned_map" title="Link to this definition">#</a></dt>
<dd><p>Bin Map-maker</p>
<p>Map a list of observations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>observations</strong> (list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Observations</span></code>) – <p>observations to be mapped.
They are required to have the following attributes as arrays</p>
<ul>
<li><dl class="simple">
<dt><cite>pointings</cite>: the pointing information (in radians) for each tod</dt><dd><p>sample. It must be a tensor with shape <code class="docutils literal notranslate"><span class="pre">(N_d,</span> <span class="pre">N_t,</span> <span class="pre">3)</span></code>,
with <code class="docutils literal notranslate"><span class="pre">N_d</span></code> number of detectors and <code class="docutils literal notranslate"><span class="pre">N_t</span></code> number of
samples in the TOD.</p>
</dd>
</dl>
</li>
<li><p>any attribute listed in <cite>components</cite> (by default, <cite>tod</cite>) and
containing the TOD(s) to be binned together.</p></li>
</ul>
<p>If the observations are distributed over some communicator(s), they
must share the same group processes.
If pointings and psi are not included in the observations, they can
be provided through an array (or a list of arrays) of dimension
(Ndetectors x Nsamples x 3), containing theta, phi and psi</p>
</p></li>
<li><p><strong>nside</strong> (<em>int</em>) – HEALPix nside of the output map</p></li>
<li><p><strong>pointings</strong> (<em>array</em><em> or </em><em>list</em><em> of </em><em>arrays</em>) – optional, external pointing
information, if not included in the observations</p></li>
<li><p><strong>output_coordinate_system</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">CoordinateSystem</span></code>) – the coordinates
to use for the output map</p></li>
<li><p><strong>components</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – list of components to include in the map-making.
The default is just to use the field <code class="docutils literal notranslate"><span class="pre">tod</span></code> of each
<a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> object</p></li>
<li><p><strong>detector_split</strong> (<em>str</em>) – select the detector split to use in the map-making</p></li>
<li><p><strong>time_split</strong> (<em>str</em>) – select the time split to use in the map-making.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>An instance of the class <code class="xref py py-class docutils literal notranslate"><span class="pre">MapMakerResult</span></code>. If the observations are</dt><dd><p>distributed over MPI Processes, all of them get a copy of the same object.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.make_destriped_map">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">make_destriped_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">nside:</span> <span class="pre">int,</span> <span class="pre">observations:</span> <span class="pre">~litebird_sim.observations.Observation</span> <span class="pre">|</span> <span class="pre">~typing.List[~litebird_sim.observations.Observation],</span> <span class="pre">pointings:</span> <span class="pre">~numpy._typing._array_like._SupportsArray[~numpy.dtype[~typing.Any]]</span> <span class="pre">|</span> <span class="pre">~numpy._typing._nested_sequence._NestedSequence[~numpy._typing._array_like._SupportsArray[~numpy.dtype[~typing.Any]]]</span> <span class="pre">|</span> <span class="pre">bool</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">complex</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">bytes</span> <span class="pre">|</span> <span class="pre">~numpy._typing._nested_sequence._NestedSequence[bool</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">complex</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">bytes]</span> <span class="pre">|</span> <span class="pre">~typing.List[~numpy._typing._array_like._SupportsArray[~numpy.dtype[~typing.Any]]</span> <span class="pre">|</span> <span class="pre">~numpy._typing._nested_sequence._NestedSequence[~numpy._typing._array_like._SupportsArray[~numpy.dtype[~typing.Any]]]</span> <span class="pre">|</span> <span class="pre">bool</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">complex</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">bytes</span> <span class="pre">|</span> <span class="pre">~numpy._typing._nested_sequence._NestedSequence[bool</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">complex</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">bytes]]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">hwp:</span> <span class="pre">~litebird_sim.hwp.HWP</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">params:</span> <span class="pre">~litebird_sim.mapmaking.destriper.DestriperParameters</span> <span class="pre">=</span> <span class="pre">DestriperParameters(output_coordinate_system=&lt;CoordinateSystem.Galactic:</span> <span class="pre">2&gt;,</span> <span class="pre">samples_per_baseline=100,</span> <span class="pre">iter_max=100,</span> <span class="pre">threshold=1e-07,</span> <span class="pre">use_preconditioner=True),</span> <span class="pre">components:</span> <span class="pre">~typing.List[str]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">keep_weights:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">keep_pixel_idx:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">keep_pol_angle_rad:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">detector_split:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'full',</span> <span class="pre">time_split:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'full',</span> <span class="pre">baselines_list:</span> <span class="pre">~typing.List[~numpy._typing._array_like._SupportsArray[~numpy.dtype[~typing.Any]]</span> <span class="pre">|</span> <span class="pre">~numpy._typing._nested_sequence._NestedSequence[~numpy._typing._array_like._SupportsArray[~numpy.dtype[~typing.Any]]]</span> <span class="pre">|</span> <span class="pre">bool</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">complex</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">bytes</span> <span class="pre">|</span> <span class="pre">~numpy._typing._nested_sequence._NestedSequence[bool</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">complex</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">bytes]]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">recycled_convergence:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False,</span> <span class="pre">callback:</span> <span class="pre">~typing.Any</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">destriper_log_callback&gt;,</span> <span class="pre">callback_kwargs:</span> <span class="pre">~typing.Dict[~typing.Any,</span> <span class="pre">~typing.Any]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.destriper.DestriperResult"><span class="pre">DestriperResult</span></a></span></span><a class="headerlink" href="#litebird_sim.mapmaking.make_destriped_map" title="Link to this definition">#</a></dt>
<dd><p>Applies the destriping algorithm to produce a map out from a TOD</p>
<p>This function takes the samples stored in the list of
<a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> objects <cite>observations</cite> and produces a destriped map.
Pointings can either be embedded in the <cite>observations</cite> objects or provided
through the parameter <cite>pointings</cite>.</p>
<p>The <cite>params</cite> argument is an instance of the class
<a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.DestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperParameters</span></code></a>, and it is used to tune the
way the destriper should solve the map-making equation.
Have a look at the documentation for this class to get
more information.</p>
<p>The samples in the TOD can be saved in several fields within each
<a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> object. For instance, you could have
generated a noise component in <cite>observations.noise_tod</cite>, the dipole in
<cite>observations.dipole_tod</cite>, etc., and you want to produce a map containing
the <em>sum</em> of all these components. In this case, you can pass
a list of strings containing the name of the fields as the
parameter <cite>components</cite>, and the destriper will add them together
before creating the map.</p>
<p>To show a few clues about the progress of the destriping algorithm,
the function accepts the <cite>callback</cite> argument. This must be a function
with the following prototype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span>
    <span class="n">stopping_factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">step_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_steps</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The parameter <cite>stopping_factor</cite> is the current stopping factor, i.e.,
the maximum residual between the current estimate of the baselines
and the result of applying the binning to the destriped TOD. The
parameter <cite>step_number</cite> is an integer between 0 and <code class="docutils literal notranslate"><span class="pre">max_steps</span> <span class="pre">-</span> <span class="pre">1</span></code>
and it is increased by 1 each time the callback is called. The
callback function can accept more parameters; in this case, their
value must be passed using the <cite>callback_kwargs</cite> parameter. For
instance, you might be running the destriper within a graphical
program and you would show a progress bar dialog; in this case, one
of the additional arguments might be an handle to the progress
window:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_gui_callback</span><span class="p">(</span>
    <span class="n">stopping_factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">step_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">window_handle</span><span class="p">:</span> <span class="n">GuiWindow</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">window_handle</span><span class="o">.</span><span class="n">set_progress</span><span class="p">(</span><span class="n">step_number</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">window_handle</span><span class="o">.</span><span class="n">text_label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Stopping factor is </span><span class="si">{</span><span class="n">stopping_factor</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>To use it, you must call <code class="docutils literal notranslate"><span class="pre">make_destriped_map</span></code> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_window_handle</span> <span class="o">=</span> <span class="n">CreateProgressWindow</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">make_destriped_map</span><span class="p">(</span>
    <span class="n">observations</span><span class="o">=</span><span class="n">obs_list</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="n">my_gui_callback</span><span class="p">,</span>
    <span class="n">callback_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;window_handle&quot;</span><span class="p">:</span> <span class="n">my_window_handle</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>observations</strong> – an instance of the class <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a>,
or a list of objects of this kind</p></li>
<li><p><strong>pointings</strong> – a 3×N array containing the values of the
θ,φ,ψ angles (in radians), or a list if <cite>observations</cite> was a
list. If no pointings are specified, they will be
taken from <cite>observations</cite> (the most common situation)</p></li>
<li><p><strong>params</strong> – an instance of the <a class="reference internal" href="#litebird_sim.mapmaking.DestriperParameters" title="litebird_sim.mapmaking.DestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperParameters</span></code></a> class</p></li>
<li><p><strong>components</strong> – a list of components to extract from
the TOD and sum together. The default is to use <cite>observations.tod</cite>.</p></li>
<li><p><strong>keep_weights</strong> – the destriper adds a <cite>destriper_weights</cite>
field to each <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> object in <cite>observations</cite>, and
it deletes it once the map has been produced. Setting
this parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code> prevents the field from being
deleted. (Useful for debugging.)</p></li>
<li><p><strong>keep_pixel_idx</strong> – same as <cite>keep_weights</cite>, but the
field to be kept from the <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a>
classes is <cite>destriper_pixel_idx</cite></p></li>
<li><p><strong>keep_pol_angle_rad</strong> – same as <cite>keep_weights</cite>, but the
field to be kept from the <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a>
classes is <cite>destriper_pol_angle_rad</cite></p></li>
<li><p><strong>callback</strong> – a function that is called during each
iteration of the CG routine. It is meant as a way to
provide some visual feedback to the user. The default
implementation uses the <code class="docutils literal notranslate"><span class="pre">logging</span></code> library to print
a line. You can provide a custom callback, if you
want (see above for an example).</p></li>
<li><p><strong>callback_kwargs</strong> – additional keyword arguments to be
passed to the <cite>callback</cite> function</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an instance of the <a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.DestriperResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">DestriperResult</span></code></a>
containing the destriped map and other useful information</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.remove_baselines_from_tod">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">remove_baselines_from_tod</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselines</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline_lengths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">_SupportsArray</span><span class="p"><span class="pre">[</span></span><span class="pre">dtype</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_NestedSequence</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">complex</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'tod'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#litebird_sim.mapmaking.remove_baselines_from_tod" title="Link to this definition">#</a></dt>
<dd><p>Subtract 1/f baselines from the TODs in <cite>obs_list</cite></p>
<p>This functions subtracts the baselines in <cite>baselines</cite> from the
<cite>component</cite> in the <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> objects listed within
the argument <cite>obs_list</cite>. The two lists <cite>baselines</cite> and
<cite>baseline_lengths</cite> must have the same number of elements as
<cite>obs_list</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs_list</strong> – A list of <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> objects
containing the TOD to be cleaned from baselines</p></li>
<li><p><strong>baselines</strong> – A list of NumPy arrays of floats (one per
each item in <cite>obs_list</cite>): each value is a baseline to
subtract</p></li>
<li><p><strong>baseline_lengths</strong> – A list of NumPy arrays of integers
(one per each item in <cite>obs_list</cite>). Each array contains
the number of samples within each baseline in the
argument <cite>baselines</cite>; the sum of all the values within
each array must be equal to the number of samples in
the TOD within the corresponding element in <cite>obs_list</cite>.</p></li>
<li><p><strong>component</strong> – The name of the TOD component to clean
from the baselines. The default is <code class="docutils literal notranslate"><span class="pre">&quot;tod&quot;</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.remove_destriper_baselines_from_tod">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">remove_destriper_baselines_from_tod</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">destriper_result</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.destriper.DestriperResult"><span class="pre">DestriperResult</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'tod'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.mapmaking.remove_destriper_baselines_from_tod" title="Link to this definition">#</a></dt>
<dd><p>A wrapper around <a class="reference internal" href="#litebird_sim.mapmaking.remove_baselines_from_tod" title="litebird_sim.mapmaking.remove_baselines_from_tod"><code class="xref py py-func docutils literal notranslate"><span class="pre">remove_baselines_from_tod()</span></code></a></p>
<p>This method removes the baselines computed by <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a> from
the TOD in the observations <cite>obs_list</cite>. The TOD component is specified
by the string <cite>component</cite>, which is <code class="docutils literal notranslate"><span class="pre">tod</span></code> by default.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs_list</strong> – A list of <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> objects
containing the TOD to be cleaned from baselines</p></li>
<li><p><strong>destriper_result</strong> – The result of a call to
<a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a></p></li>
<li><p><strong>component</strong> – The name of the TOD component to clean.
The default is <code class="docutils literal notranslate"><span class="pre">&quot;tod&quot;</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.mapmaking.save_destriper_results">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.mapmaking.</span></span><span class="sig-name descname"><span class="pre">save_destriper_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.mapmaking.DestriperResult" title="litebird_sim.mapmaking.destriper.DestriperResult"><span class="pre">DestriperResult</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_folder</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_dest_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_base_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#litebird_sim.mapmaking.save_destriper_results" title="Link to this definition">#</a></dt>
<dd><p>Save the results of a call to <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a> to disk</p>
<p>The results are saved in a set of FITS files:</p>
<ol class="arabic simple">
<li><p>A FITS file containing the maps (destriped, binned, hits), the N_obs matrix,
and general information about the convergence</p></li>
<li><p>A set of FITS files containing the baselines. Each MPI process writes <em>one</em>
file containing its baselines.</p></li>
</ol>
<p>The only parameter that is not saved is the field
<code class="docutils literal notranslate"><span class="pre">results.params.samples_per_baseline</span></code>: its type is very versatile
and would not fit well in the FITS file format. Moreover, the necessary
information is already available in the baseline lengths that are
saved in the files (see point 2. above).</p>
<p>To load the results from the files, use <a class="reference internal" href="#litebird_sim.mapmaking.load_destriper_results" title="litebird_sim.mapmaking.load_destriper_results"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_destriper_results()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>results</strong> – The result of the call to <a class="reference internal" href="#litebird_sim.mapmaking.make_destriped_map" title="litebird_sim.mapmaking.make_destriped_map"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a></p></li>
<li><p><strong>output_folder</strong> – The folder where to save all the FITS files</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function" id="module-litebird_sim.madam">
<dt class="sig sig-object py" id="litebird_sim.madam.ensure_parent_dir_exists">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.madam.</span></span><span class="sig-name descname"><span class="pre">ensure_parent_dir_exists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.madam.ensure_parent_dir_exists" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.madam.save_simulation_for_madam">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.madam.</span></span><span class="sig-name descname"><span class="pre">save_simulation_for_madam</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="simulations.html#litebird_sim.simulations.Simulation" title="litebird_sim.simulations.Simulation"><span class="pre">Simulation</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.mapmaking.ExternalDestriperParameters" title="litebird_sim.mapmaking.common.ExternalDestriperParameters"><span class="pre">ExternalDestriperParameters</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">detectors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="detectors.html#litebird_sim.detectors.DetectorInfo" title="litebird_sim.detectors.DetectorInfo"><span class="pre">DetectorInfo</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gzip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absolute_paths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">madam_subfolder_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'madam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">['tod']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components_to_bin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_pointings</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_tods</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#litebird_sim.madam.save_simulation_for_madam" title="Link to this definition">#</a></dt>
<dd><p>Save the TODs and pointings of a simulation to files suitable to be read by Madam</p>
<p>This function takes all the TOD samples and pointing angles from <cite>sim</cite> and saves
them to the directory specified by <cite>output_path</cite> (the default is to save them
in a sub-folder of the output path of the simulation). The parameter <cite>detector</cite>
must be a list of <a class="reference internal" href="detectors.html#litebird_sim.detectors.DetectorInfo" title="litebird_sim.detectors.DetectorInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">DetectorInfo</span></code></a> objects, and it specifies which detectors
will be saved to disk; if it is <code class="docutils literal notranslate"><span class="pre">None</span></code>, all the detectors in the simulation will
be considered. The variable <cite>params</cite> specifies how Madam should produce the maps;
see the documentation for <a class="reference internal" href="#litebird_sim.mapmaking.ExternalDestriperParameters" title="litebird_sim.mapmaking.ExternalDestriperParameters"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExternalDestriperParameters</span></code></a> for more
information.</p>
<p>If <cite>use_gzip</cite> is true, the TOD and pointing files will be compressed using Gzip
(the default is false, as this might slow down I/O). If <cite>absolute_paths</cite> is <code class="docutils literal notranslate"><span class="pre">True</span></code>
(the default), the parameter and simulation files produced by this routine will
be <em>absolute</em>; set it to <cite>False</cite> if you plan to move the FITS files to some other
directory or computer before running Madam.</p>
<p>The parameter <cite>madam_subfolder_name</cite> is the name of the directory within the
output folder of the simulation that will contain the Madam parameter files.</p>
<p>You can use multiple TODs in the map-making process. By default, the code will
only dump <code class="docutils literal notranslate"><span class="pre">Observation.tod</span></code> in the FITS files, but you can specify additional
components via the <cite>components</cite> parameter, which is a list of the fields that
must be saved in the FITS files and included in the parameter and simulation
files. All these components will be summed in the map-making process.</p>
<p>If you want to create a map using just a subset of the components listed in the
<cite>components</cite> parameter, list them in <cite>components_to_bin</cite>. (This is usually
employed when you pass <code class="docutils literal notranslate"><span class="pre">save_pointings=False</span></code> and <code class="docutils literal notranslate"><span class="pre">save_tods=False</span></code>.) If
<cite>components_to_bin</cite> is <code class="docutils literal notranslate"><span class="pre">None</span></code> (the default), all the elements in <cite>components</cite>
will be used.</p>
<p>If you are using MPI, call this function on <em>all</em> the MPI processes, not just on
the one with rank #0.</p>
<p>The flags <cite>save_pointings</cite> and <cite>save_tods</cite> are used to tell if you want pointings
and TODs to be saved in FITS files or not. If either flag is set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, the
corresponding FITS files will not be produced, but the <code class="docutils literal notranslate"><span class="pre">.sim</span></code> file for Madam
will nevertheless list them as if they were created. This is useful if you plan to
reuse files from some other call to <code class="docutils literal notranslate"><span class="pre">save_simulation_for_madam</span></code>; in this case,
a common trick is to create soft links to them in the output directory where the
<code class="docutils literal notranslate"><span class="pre">.par</span></code> and <code class="docutils literal notranslate"><span class="pre">.sim</span></code> files are saved.</p>
<p>The return value is either a dictionary containing all the parameters used to
fill Madam files (the parameter file and the simulation file) or <code class="docutils literal notranslate"><span class="pre">None</span></code>;
the dictionary is only returned for the MPI process with rank #0.</p>
</dd></dl>

</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="part5.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Data-reduction modules</p>
      </div>
    </a>
    <a class="right-next"
       href="part6.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorials</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#binner">Binner</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-splits">Data splits</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#destriper">Destriper</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-the-n-obs-matrix-is-stored">How the N_obs matrix is stored</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Data splits</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#toast2-destriper">TOAST2 Destriper</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-files-for-madam">Saving files for Madam</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-several-maps-with-madam">Creating several maps with Madam</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-litebird_sim.mapmaking">API reference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.BinnerResult"><code class="docutils literal notranslate"><span class="pre">BinnerResult</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.BinnerResult.binned_map"><code class="docutils literal notranslate"><span class="pre">BinnerResult.binned_map</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.BinnerResult.components"><code class="docutils literal notranslate"><span class="pre">BinnerResult.components</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.BinnerResult.coordinate_system"><code class="docutils literal notranslate"><span class="pre">BinnerResult.coordinate_system</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.BinnerResult.detector_split"><code class="docutils literal notranslate"><span class="pre">BinnerResult.detector_split</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.BinnerResult.invnpp"><code class="docutils literal notranslate"><span class="pre">BinnerResult.invnpp</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.BinnerResult.time_split"><code class="docutils literal notranslate"><span class="pre">BinnerResult.time_split</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperParameters"><code class="docutils literal notranslate"><span class="pre">DestriperParameters</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperParameters.iter_max"><code class="docutils literal notranslate"><span class="pre">DestriperParameters.iter_max</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperParameters.output_coordinate_system"><code class="docutils literal notranslate"><span class="pre">DestriperParameters.output_coordinate_system</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperParameters.samples_per_baseline"><code class="docutils literal notranslate"><span class="pre">DestriperParameters.samples_per_baseline</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperParameters.threshold"><code class="docutils literal notranslate"><span class="pre">DestriperParameters.threshold</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperParameters.use_preconditioner"><code class="docutils literal notranslate"><span class="pre">DestriperParameters.use_preconditioner</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult"><code class="docutils literal notranslate"><span class="pre">DestriperResult</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.baseline_errors"><code class="docutils literal notranslate"><span class="pre">DestriperResult.baseline_errors</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.baseline_lengths"><code class="docutils literal notranslate"><span class="pre">DestriperResult.baseline_lengths</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.baselines"><code class="docutils literal notranslate"><span class="pre">DestriperResult.baselines</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.binned_map"><code class="docutils literal notranslate"><span class="pre">DestriperResult.binned_map</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.bytes_in_temporary_buffers"><code class="docutils literal notranslate"><span class="pre">DestriperResult.bytes_in_temporary_buffers</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.components"><code class="docutils literal notranslate"><span class="pre">DestriperResult.components</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.converged"><code class="docutils literal notranslate"><span class="pre">DestriperResult.converged</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.coordinate_system"><code class="docutils literal notranslate"><span class="pre">DestriperResult.coordinate_system</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.destriped_map"><code class="docutils literal notranslate"><span class="pre">DestriperResult.destriped_map</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.detector_split"><code class="docutils literal notranslate"><span class="pre">DestriperResult.detector_split</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.elapsed_time_s"><code class="docutils literal notranslate"><span class="pre">DestriperResult.elapsed_time_s</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.history_of_stopping_factors"><code class="docutils literal notranslate"><span class="pre">DestriperResult.history_of_stopping_factors</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.hit_map"><code class="docutils literal notranslate"><span class="pre">DestriperResult.hit_map</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.nobs_matrix_cholesky"><code class="docutils literal notranslate"><span class="pre">DestriperResult.nobs_matrix_cholesky</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.nside"><code class="docutils literal notranslate"><span class="pre">DestriperResult.nside</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.params"><code class="docutils literal notranslate"><span class="pre">DestriperResult.params</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.stopping_factor"><code class="docutils literal notranslate"><span class="pre">DestriperResult.stopping_factor</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.DestriperResult.time_split"><code class="docutils literal notranslate"><span class="pre">DestriperResult.time_split</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.baseline_length_s"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.baseline_length_s</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.coordinate_system"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.coordinate_system</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.iter_max"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.iter_max</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.nnz"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.nnz</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.nside"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.nside</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.output_file_prefix"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.output_file_prefix</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_binned_map"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.return_binned_map</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_destriped_map"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.return_destriped_map</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_hit_map"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.return_hit_map</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_invnpp"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.return_invnpp</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_npp"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.return_npp</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.ExternalDestriperParameters.return_rcond"><code class="docutils literal notranslate"><span class="pre">ExternalDestriperParameters.return_rcond</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.check_valid_splits"><code class="docutils literal notranslate"><span class="pre">check_valid_splits()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.destriper_log_callback"><code class="docutils literal notranslate"><span class="pre">destriper_log_callback()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.load_destriper_results"><code class="docutils literal notranslate"><span class="pre">load_destriper_results()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.make_binned_map"><code class="docutils literal notranslate"><span class="pre">make_binned_map()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.make_destriped_map"><code class="docutils literal notranslate"><span class="pre">make_destriped_map()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.remove_baselines_from_tod"><code class="docutils literal notranslate"><span class="pre">remove_baselines_from_tod()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.remove_destriper_baselines_from_tod"><code class="docutils literal notranslate"><span class="pre">remove_destriper_baselines_from_tod()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.mapmaking.save_destriper_results"><code class="docutils literal notranslate"><span class="pre">save_destriper_results()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.madam.ensure_parent_dir_exists"><code class="docutils literal notranslate"><span class="pre">ensure_parent_dir_exists()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.madam.save_simulation_for_madam"><code class="docutils literal notranslate"><span class="pre">save_simulation_for_madam()</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/mapmaking.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2020, The LiteBIRD Simulation Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>