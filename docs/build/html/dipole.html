
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Dipole anisotropy &#8212; LBS 0.13.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/asciinema-player_2.6.1.css" />
    <link rel="stylesheet" type="text/css" href="_static/asciinema-custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/contentui.css" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=1019fba8"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/asciinema-player_2.6.1.js"></script>
    <script src="_static/contentui.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dipole';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scanning a map to fill a TOD" href="map_scanning.html" />
    <link rel="prev" title="Synthetic sky maps" href="sky_maps.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">LBS 0.13.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="part1.html">
    Introduction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part2.html">
    Structure of the framework
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="part3.html">
    Basic simulation modules
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part4.html">
    Systematic effects
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part5.html">
    Data-reduction modules
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="part6.html">
    Tutorials
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="appendix.html">
    Appendices
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="installation.html">
    Installation
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="part1.html">
    Introduction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part2.html">
    Structure of the framework
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="part3.html">
    Basic simulation modules
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part4.html">
    Systematic effects
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part5.html">
    Data-reduction modules
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="part6.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="appendix.html">
    Appendices
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="installation.html">
    Installation
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scanning.html">Scanning strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="quaternions.html">Quaternions</a></li>
<li class="toctree-l1"><a class="reference internal" href="hwp.html">Ideal Half Wave Plate</a></li>
<li class="toctree-l1"><a class="reference internal" href="noise.html">Instrumental noise</a></li>
<li class="toctree-l1"><a class="reference internal" href="sky_maps.html">Synthetic sky maps</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Dipole anisotropy</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_scanning.html">Scanning a map to fill a TOD</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="part3.html" class="nav-link">Basic simulation modules</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Dipole anisotropy</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="dipole-anisotropy">
<span id="id1"></span><h1>Dipole anisotropy<a class="headerlink" href="#dipole-anisotropy" title="Link to this heading">#</a></h1>
<p>The LiteBIRD Simulation Framework provides tools to simulate the
signal associated with the relative velocity between the rest frame of
the spacecraft with respect to the CMB. The motion of the spacecraft
in the rest frame of the CMB is the composition of several components:</p>
<ol class="arabic simple">
<li><p>The motion of the spacecraft around L2;</p></li>
<li><p>The motion of the L2 point in the Ecliptic plane;</p></li>
<li><p>The motion of the Solar System around the Galactic Centre;</p></li>
<li><p>The motion of the Milky Way.</p></li>
</ol>
<p>Components 1 and 2 are simulated by the LiteBIRD Simulation Framework
using appropriate motion models, while components 3 and 4 are included
using the Sun velocity derived by the solar dipole measured by the
Planck satellite.</p>
<p>The motion of the spacecraft around L2 is modelled using a Lissajous
orbit similar to what was used for the WMAP experiment
<span id="id2">[<a class="reference internal" href="bibliography.html#id4" title="Joseph Cavaluzzi, Dale Fink, and Steve Coyle. Wilkinson microwave anisotropy probe shadow avoidance maneuver planning and execution. In SpaceOps 2008 Conference. American Institute of Aeronautics and Astronautics, May 2008. URL: https://doi.org/10.2514/6.2008-3315, doi:10.2514/6.2008-3315.">1</a>]</span>, and it is encoded using the
<a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftOrbit" title="litebird_sim.spacecraft.SpacecraftOrbit"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftOrbit</span></code></a> class.</p>
<section id="position-and-velocity-of-the-spacecraft">
<h2>Position and velocity of the spacecraft<a class="headerlink" href="#position-and-velocity-of-the-spacecraft" title="Link to this heading">#</a></h2>
<p>The class <a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftOrbit" title="litebird_sim.spacecraft.SpacecraftOrbit"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftOrbit</span></code></a> describes the orbit of the
LiteBIRD spacecraft with respect to the Barycentric Ecliptic Reference
Frame and the motion of the Barycentric Ecliptic Reference Frame with
respect to the CMB; this class is necessary because the class
<a class="reference internal" href="scanning.html#litebird_sim.scanning.ScanningStrategy" title="litebird_sim.scanning.ScanningStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScanningStrategy</span></code></a> (see the chapter <a class="reference internal" href="scanning.html#scanning-strategy"><span class="std std-ref">Scanning strategy</span></a>)
only models the <em>direction</em> each instrument is looking at but knows
nothing about the velocity of the spacecraft itself.</p>
<p>The class <a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftOrbit" title="litebird_sim.spacecraft.SpacecraftOrbit"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftOrbit</span></code></a> is a dataclass that can initialize
its members to sensible default values taken from the literature. As
the LiteBIRD orbit around L2 is not fixed yet, the code assumes a
WMAP-like Lissajous orbit, <span id="id3">[<a class="reference internal" href="bibliography.html#id4" title="Joseph Cavaluzzi, Dale Fink, and Steve Coyle. Wilkinson microwave anisotropy probe shadow avoidance maneuver planning and execution. In SpaceOps 2008 Conference. American Institute of Aeronautics and Astronautics, May 2008. URL: https://doi.org/10.2514/6.2008-3315, doi:10.2514/6.2008-3315.">1</a>]</span>. For the Sun
velocity it assumes Planck 2018 solar dipole
<span id="id4">[<a class="reference internal" href="bibliography.html#id8" title="Planck Collaboration, N. Aghanim, Y. Akrami, M. Ashdown, J. Aumont, C. Baccigalupi, M. Ballardini, A. J. Banday, R. B. Barreiro, N. Bartolo, S. Basak, K. Benabed, J. -P. Bernard, M. Bersanelli, P. Bielewicz, J. R. Bond, J. Borrill, F. R. Bouchet, F. Boulanger, M. Bucher, C. Burigana, E. Calabrese, J. -F. Cardoso, J. Carron, A. Challinor, H. C. Chiang, L. P. L. Colombo, C. Combet, F. Couchot, B. P. Crill, F. Cuttaia, P. de Bernardis, A. de Rosa, G. de Zotti, J. Delabrouille, J. -M. Delouis, E. Di Valentino, J. M. Diego, O. Doré, M. Douspis, A. Ducout, X. Dupac, G. Efstathiou, F. Elsner, T. A. Enßlin, H. K. Eriksen, E. Falgarone, Y. Fantaye, F. Finelli, M. Frailis, A. A. Fraisse, E. Franceschi, A. Frolov, S. Galeotta, S. Galli, K. Ganga, R. T. Génova-Santos, M. Gerbino, T. Ghosh, J. González-Nuevo, K. M. Górski, S. Gratton, A. Gruppuso, J. E. Gudmundsson, W. Handley, F. K. Hansen, S. Henrot-Versillé, D. Herranz, E. Hivon, Z. Huang, A. H. Jaffe, W. C. Jones, A. Karakci, E. Keihänen, R. Keskitalo, K. Kiiveri, J. Kim, T. S. Kisner, N. Krachmalnicoff, M. Kunz, H. Kurki-Suonio, G. Lagache, J. -M. Lamarre, A. Lasenby, M. Lattanzi, C. R. Lawrence, F. Levrier, M. Liguori, P. B. Lilje, V. Lindholm, M. López-Caniego, Y. -Z. Ma, J. F. Macías-Pérez, G. Maggio, D. Maino, N. Mandolesi, A. Mangilli, P. G. Martin, E. Martínez-González, S. Matarrese, N. Mauri, J. D. McEwen, A. Melchiorri, A. Mennella, M. Migliaccio, M. -A. Miville-Deschênes, D. Molinari, A. Moneti, L. Montier, G. Morgante, A. Moss, S. Mottet, P. Natoli, L. Pagano, D. Paoletti, B. Partridge, G. Patanchon, L. Patrizii, O. Perdereau, F. Perrotta, V. Pettorino, F. Piacentini, J. -L. Puget, J. P. Rachen, M. Reinecke, M. Remazeilles, A. Renzi, G. Rocha, G. Roudier, L. Salvati, M. Sandri, M. Savelainen, D. Scott, C. Sirignano, G. Sirri, L. D. Spencer, R. Sunyaev, A. -S. Suur-Uski, J. A. Tauber, D. Tavagnacco, M. Tenti, L. Toffolatti, M. Tomasi, M. Tristram, T. Trombetti, J. Valiviita, F. Vansyngel, B. Van Tent, L. Vibert, P. Vielva, F. Villa, N. Vittorio, B. D. Wandelt, I. K. Wehus, and A. Zonca. Planck 2018 results. III. High Frequency Instrument data processing and frequency maps. \aap , 641:A3, September 2020. arXiv:1807.06207, doi:10.1051/0004-6361/201832909.">6</a>]</span>.</p>
<p>To compute the position/velocity of the spacecraft, you call
<a class="reference internal" href="#litebird_sim.spacecraft.spacecraft_pos_and_vel" title="litebird_sim.spacecraft.spacecraft_pos_and_vel"><code class="xref py py-func docutils literal notranslate"><span class="pre">spacecraft_pos_and_vel()</span></code></a>; it requires either a period or an
<a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> object, and it returns an instance of the class
<a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity" title="litebird_sim.spacecraft.SpacecraftPositionAndVelocity"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftPositionAndVelocity</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">litebird_sim</span> <span class="k">as</span> <span class="nn">lbs</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>

<span class="n">orbit</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">SpacecraftOrbit</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2023-01-01&quot;</span><span class="p">))</span>
<span class="n">posvel</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">spacecraft_pos_and_vel</span><span class="p">(</span>
    <span class="n">orbit</span><span class="p">,</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">orbit</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
    <span class="n">time_span_s</span><span class="o">=</span><span class="mf">86_400.0</span><span class="p">,</span>  <span class="c1"># One day</span>
    <span class="n">delta_time_s</span><span class="o">=</span><span class="mf">3600.0</span>    <span class="c1"># One hour</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">posvel</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SpacecraftPositionAndVelocity(start_time=2023-01-01 00:00:00.000, time_span_s=86400.0, nsamples=25)
</pre></div>
</div>
<p>The output of the script shows that 25 «samples» have been computed;
this means that the <code class="docutils literal notranslate"><span class="pre">posvel</span></code> variable holds information about 25
position/velocity pairs evenly spaced between 2023-01-01 and
2023-01-02: one at midnight, one at 1:00, etc., till midnight
2023-01-02. The <a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity" title="litebird_sim.spacecraft.SpacecraftPositionAndVelocity"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftPositionAndVelocity</span></code></a> class keeps
the table with the positions and the velocities in the fields
<code class="docutils literal notranslate"><span class="pre">positions_km</span></code> and <code class="docutils literal notranslate"><span class="pre">velocities_km_s</span></code>, respectively, which are
arrays of shape <code class="docutils literal notranslate"><span class="pre">(nsamples,</span> <span class="pre">3)</span></code>.</p>
<p>Here is a slightly more complex example that shows how to plot the
distance between the spacecraft and the Sun as a function of time and
speed. The latter quantity is, of course, most relevant when computing
the CMB dipole.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">litebird_sim</span> <span class="k">as</span> <span class="nn">lbs</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">orbit</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">SpacecraftOrbit</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2023-01-01&quot;</span><span class="p">))</span>

<span class="n">posvel</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">spacecraft_pos_and_vel</span><span class="p">(</span>
    <span class="n">orbit</span><span class="p">,</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">orbit</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
    <span class="n">time_span_s</span><span class="o">=</span><span class="mf">3.15e7</span><span class="p">,</span>  <span class="c1"># One year</span>
    <span class="n">delta_time_s</span><span class="o">=</span><span class="mf">86_400.0</span><span class="p">,</span>  <span class="c1"># One day</span>
<span class="p">)</span>

<span class="c1"># posvel.positions_km is a N×3 array containing the XYZ position</span>
<span class="c1"># of the spacecraft calculated every day for one year. We compute</span>
<span class="c1"># the modulus of the position, which is of course the</span>
<span class="c1"># Sun-LiteBIRD distance.</span>
<span class="n">sun_distance_km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">posvel</span><span class="o">.</span><span class="n">positions_km</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># We do the same with the velocities</span>
<span class="n">speed_km_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">posvel</span><span class="o">.</span><span class="n">velocities_km_s</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Plot distance and speed as functions of time</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sun_distance_km</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Distance [km]&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">speed_km_s</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Speed [km/s]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/1a23db2426a59e7579e865ba811a62e2/spacecraft_demo.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/c801375eacf27ac75efaedee3f62e2c2/spacecraft_demo.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/f8704f44ef47aebc8d1644b811851eb1/spacecraft_demo.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/bdc082ba2af4303a964695b790258f9c/spacecraft_demo.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/spacecraft_demo.png" class="plot-directive" src="_images/spacecraft_demo.png" />
</figure>
</section>
<section id="computing-the-dipole">
<h2>Computing the dipole<a class="headerlink" href="#computing-the-dipole" title="Link to this heading">#</a></h2>
<p>The CMB dipole is caused by a Doppler shift of the frequencies
observed while looking at the CMB blackbody spectrum, according to the formula</p>
<div class="math notranslate nohighlight" id="equation-dipole">
<span class="eqno">(1)<a class="headerlink" href="#equation-dipole" title="Link to this equation">#</a></span>\[T(\vec\beta, \hat n) = \frac{T_0}{\gamma \bigl(1 - \vec\beta \cdot \hat n\bigr)},\]</div>
<p>where <span class="math notranslate nohighlight">\(T_0\)</span> is the temperature in the rest frame of the CMB,
<span class="math notranslate nohighlight">\(\vec \beta = \vec v / c\)</span> is the dimensionless velocity vector,
<span class="math notranslate nohighlight">\(\hat n\)</span> is the direction of the line of sight, and
<span class="math notranslate nohighlight">\(\gamma = \bigl(1 - \vec\beta \cdot \vec\beta\bigr)^2\)</span>.</p>
<p>However, CMB experiments usually employ the linear thermodynamic
temperature definition, where temperature differences <span class="math notranslate nohighlight">\(\Delta_1 T\)</span>
are related to the actual temperature difference <span class="math notranslate nohighlight">\(\Delta T\)</span> by
the relation</p>
<div class="math notranslate nohighlight" id="equation-linearized-dipole">
<span class="eqno">(2)<a class="headerlink" href="#equation-linearized-dipole" title="Link to this equation">#</a></span>\[\Delta_1 T = \frac{T_0}{f(x)} \left(\frac{\mathrm{BB}(T_0 + \Delta T)}{\mathrm{BB}(T_0)} - 1\right) =
\frac{T_0}{f(x)} \left(\frac{\exp x - 1}{\exp\left(x\frac{T_0}{T_0 + \Delta T}\right) - 1} - 1\right),\]</div>
<p>where <span class="math notranslate nohighlight">\(x = h \nu / k_B T\)</span>,</p>
<div class="math notranslate nohighlight">
\[f(x) = \frac{x e^x}{e^x - 1},\]</div>
<p>and <span class="math notranslate nohighlight">\(\mathrm{BB}(\nu, T)\)</span> is the spectral radiance of a
black-body according to Planck’s law:</p>
<div class="math notranslate nohighlight">
\[\mathrm{BB}(\nu, T) = \frac{2h\nu^3}{c^2} \frac1{e^{h\nu/k_B T} - 1} = \frac{2h\nu^3}{c^2} \frac1{e^x - 1}.\]</div>
<p>There is no numerical issue in computing the complete formula, but
often, models use some simplifications to make the math more
manageable to work on the blackboard. The LiteBIRD Simulation
Framework implements several simplifications of the formula, which are
based on a series expansion of <a class="reference internal" href="#equation-dipole">(1)</a>; the caller must pass an
object of type <a class="reference internal" href="#litebird_sim.dipole.DipoleType" title="litebird_sim.dipole.DipoleType"><code class="xref py py-class docutils literal notranslate"><span class="pre">DipoleType</span></code></a> (an <a class="reference external" href="https://docs.python.org/3/library/enum.html">enum class</a>), whose value signals
which kind of approximation to use:</p>
<ol class="arabic">
<li><p>The most simple formula uses a series expansion of <a class="reference internal" href="#equation-dipole">(1)</a> at
the first order:</p>
<div class="math notranslate nohighlight">
\[\Delta T(\vec\beta, \hat n) = T_0 \vec\beta\cdot\hat n,\]</div>
<p>which is associated to the constant <code class="docutils literal notranslate"><span class="pre">DipoleType.LINEAR</span></code>.</p>
</li>
<li><p>The same series expansion for <a class="reference internal" href="#equation-dipole">(1)</a>, but stopped at the
second order (<code class="docutils literal notranslate"><span class="pre">DipoleType.QUADRATIC_EXACT</span></code>):</p>
<div class="math notranslate nohighlight">
\[\Delta T(\vec\beta, \hat n) = T_0\left(\vec\beta\cdot\hat n + \bigl(\vec\beta\cdot\hat n\bigr)^2\right),\]</div>
<p>which discards a <span class="math notranslate nohighlight">\(-T_0\,\beta^2/2\)</span> term (monopole).</p>
</li>
<li><p>The exact formula as in <a class="reference internal" href="#equation-dipole">(1)</a> (<code class="docutils literal notranslate"><span class="pre">DipoleType.TOTAL_EXACT</span></code>).</p></li>
<li><p>Using a series expansion to the second order of
<a class="reference internal" href="#equation-linearized-dipole">(2)</a> instead of <a class="reference internal" href="#equation-dipole">(1)</a> and neglecting
monopoles (<code class="docutils literal notranslate"><span class="pre">DipoleTotal.QUADRATIC_FROM_LIN_T</span></code>):</p>
<div class="math notranslate nohighlight">
\[\Delta_2 T(\nu) = T_0 \left(\vec\beta\cdot\hat n + q(x) \bigl(\vec\beta\cdot\hat n\bigr)^2\right),\]</div>
<p>where the dependence on the frequency ν is due to the presence of
the term <span class="math notranslate nohighlight">\(x = h\nu / k_B T\)</span> in the equation. This is the
formula to use if you want the leading frequency-dependent term
(second order) without the boosting induced monopoles.</p>
</li>
<li><p>Finally, linearizing <a class="reference internal" href="#equation-dipole">(1)</a> through <a class="reference internal" href="#equation-linearized-dipole">(2)</a>
(<code class="docutils literal notranslate"><span class="pre">DipoleTotal.TOTAL_FROM_LIN_T</span></code>):</p>
<div class="math notranslate nohighlight">
\[\Delta T = \frac{T_0}{f(x)} \left(\frac{\mathrm{BB}\left(T_0 / \gamma\bigl(1 - \vec\beta\cdot\hat n\bigr)\right)}{\mathrm{BB}(T_0)} - 1\right) =
\frac{T_0}{f(x)} \left(\frac{\mathrm{BB}\bigl(\nu\gamma(1-\vec\beta\cdot\hat n), T_0\bigr)}{\bigl(\gamma(1-\vec\beta\cdot\hat n)\bigr)^3\mathrm{BB}(T_0)}\right).\]</div>
<p>In this case too, the temperature variation depends on the
frequency because of <a class="reference internal" href="#equation-linearized-dipole">(2)</a>. This is the formula
that is typically used by CMB experiments.</p>
</li>
</ol>
<p>You can <em>add</em> the dipole signal to an existing TOD through the
function <a class="reference internal" href="#litebird_sim.dipole.add_dipole_to_observations" title="litebird_sim.dipole.add_dipole_to_observations"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_dipole_to_observations()</span></code></a>, as the following example
shows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">litebird_sim</span> <span class="k">as</span> <span class="nn">lbs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2022-01-01&quot;</span><span class="p">)</span>
<span class="n">time_span_s</span> <span class="o">=</span> <span class="mf">120.0</span>  <span class="c1"># Two minutes</span>
<span class="n">sampling_hz</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">duration_s</span><span class="o">=</span><span class="n">time_span_s</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>

<span class="c1"># We pick a simple scanning strategy where the spin axis is aligned</span>
<span class="c1"># with the Sun-Earth axis, and the spacecraft spins once every minute</span>
<span class="n">sim</span><span class="o">.</span><span class="n">set_scanning_strategy</span><span class="p">(</span>
    <span class="n">lbs</span><span class="o">.</span><span class="n">SpinningScanningStrategy</span><span class="p">(</span>
        <span class="n">spin_sun_angle_rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">precession_rate_hz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">spin_rate_hz</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
        <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">delta_time_s</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># We simulate an instrument whose boresight is perpendicular to</span>
<span class="c1"># the spin axis.</span>
<span class="n">sim</span><span class="o">.</span><span class="n">set_instrument</span><span class="p">(</span>
    <span class="n">lbs</span><span class="o">.</span><span class="n">InstrumentInfo</span><span class="p">(</span>
        <span class="n">boresight_rotangle_rad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">spin_boresight_angle_rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span>
        <span class="n">spin_rotangle_rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">75</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># A simple detector looking along the boresight direction</span>
<span class="n">det</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">DetectorInfo</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Boresight_detector&quot;</span><span class="p">,</span>
    <span class="n">sampling_rate_hz</span><span class="o">=</span><span class="n">sampling_hz</span><span class="p">,</span>
    <span class="n">bandcenter_ghz</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
<span class="p">)</span>

<span class="p">(</span><span class="n">obs</span><span class="p">,)</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_observations</span><span class="p">(</span><span class="n">detectors</span><span class="o">=</span><span class="p">[</span><span class="n">det</span><span class="p">])</span>

<span class="n">sim</span><span class="o">.</span><span class="n">prepare_pointings</span><span class="p">()</span>

<span class="c1"># Simulate the orbit of the spacecraft and compute positions and</span>
<span class="c1"># velocities</span>
<span class="n">orbit</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">SpacecraftOrbit</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
<span class="n">pos_vel</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">spacecraft_pos_and_vel</span><span class="p">(</span><span class="n">orbit</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">delta_time_s</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">get_times</span><span class="p">()</span>
<span class="n">t</span> <span class="o">-=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Make `t` start from zero</span>

<span class="c1"># Create two plots: the first shows the full two-minute time span, and</span>
<span class="c1"># the second one shows a zoom over the very first points of the TOD.</span>
<span class="n">_</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Make a plot of the TOD using all the dipole types</span>
<span class="k">for</span> <span class="n">type_idx</span><span class="p">,</span> <span class="n">dipole_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lbs</span><span class="o">.</span><span class="n">DipoleType</span><span class="p">):</span>
    <span class="n">obs</span><span class="o">.</span><span class="n">tod</span><span class="p">[</span><span class="mi">0</span><span class="p">][:]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Reset the TOD</span>
    <span class="n">lbs</span><span class="o">.</span><span class="n">add_dipole_to_observations</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">pos_vel</span><span class="p">,</span> <span class="n">dipole_type</span><span class="o">=</span><span class="n">dipole_type</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">obs</span><span class="o">.</span><span class="n">tod</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">dipole_type</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">obs</span><span class="o">.</span><span class="n">tod</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">dipole_type</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Signal [K]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Signal [K]&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="_downloads/db9d2aed004b9cdb4001394d56adf8c2/dipole_demo.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="_downloads/fd61824b95cfd15e67ffbfd2efd491a6/dipole_demo.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="_downloads/1d737c7888c940f957b5e5b7f9b6c376/dipole_demo.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="_downloads/24922bc47ca45a6c04ef342c5a856d8b/dipole_demo.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="_images/dipole_demo.png" class="plot-directive" src="_images/dipole_demo.png" />
</figure>
<p>The example plots two minutes of a simulated timeline for a very
simple instrument, and it zooms over the very first points to show
that there is indeed some difference in the estimate provided by each
method.</p>
</section>
<section id="methods-of-class-simulation">
<h2>Methods of class simulation<a class="headerlink" href="#methods-of-class-simulation" title="Link to this heading">#</a></h2>
<p>The class <a class="reference internal" href="simulations.html#litebird_sim.simulations.Simulation" title="litebird_sim.simulations.Simulation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Simulation</span></code></a> provides two simple functions that compute
poisition and velocity of the spacescraft <code class="xref py py-func docutils literal notranslate"><span class="pre">Simulation.compute_pos_and_vel()</span></code>,
and add the solar and orbital dipole to all the observations of a given
simulation <code class="xref py py-func docutils literal notranslate"><span class="pre">Simulation.add_dipole()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">litebird_sim</span> <span class="k">as</span> <span class="nn">lbs</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2025-01-01&quot;</span><span class="p">)</span>
<span class="n">time_span_s</span> <span class="o">=</span> <span class="mf">1000.0</span>
<span class="n">sampling_hz</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
    <span class="n">duration_s</span><span class="o">=</span><span class="n">time_span_s</span><span class="p">,</span>
    <span class="n">random_seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># We pick a simple scanning strategy where the spin axis is aligned</span>
<span class="c1"># with the Sun-Earth axis, and the spacecraft spins once every minute</span>
<span class="n">sim</span><span class="o">.</span><span class="n">set_scanning_strategy</span><span class="p">(</span>
    <span class="n">lbs</span><span class="o">.</span><span class="n">SpinningScanningStrategy</span><span class="p">(</span>
        <span class="n">spin_sun_angle_rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">precession_rate_hz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">spin_rate_hz</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>
        <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">delta_time_s</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
 <span class="p">)</span>

<span class="c1"># We simulate an instrument whose boresight is perpendicular to</span>
<span class="c1"># the spin axis.</span>
<span class="n">sim</span><span class="o">.</span><span class="n">set_instrument</span><span class="p">(</span>
    <span class="n">lbs</span><span class="o">.</span><span class="n">InstrumentInfo</span><span class="p">(</span>
        <span class="n">boresight_rotangle_rad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">spin_boresight_angle_rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span>
        <span class="n">spin_rotangle_rad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">75</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># A simple detector looking along the boresight direction</span>
<span class="n">det</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">DetectorInfo</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Boresight_detector&quot;</span><span class="p">,</span>
    <span class="n">sampling_rate_hz</span><span class="o">=</span><span class="n">sampling_hz</span><span class="p">,</span>
    <span class="n">bandcenter_ghz</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sim</span><span class="o">.</span><span class="n">create_observations</span><span class="p">(</span><span class="n">detectors</span><span class="o">=</span><span class="n">det</span><span class="p">)</span>

<span class="n">sim</span><span class="o">.</span><span class="n">prepare_pointings</span><span class="p">()</span>

<span class="n">sim</span><span class="o">.</span><span class="n">compute_pos_and_vel</span><span class="p">()</span>

<span class="n">sim</span><span class="o">.</span><span class="n">add_dipole</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sim</span><span class="o">.</span><span class="n">observations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tod</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.5e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>3.44963e-03
3.45207e-03
3.45413e-03
3.45582e-03
3.45712e-03
</pre></div>
</div>
<p>Note that even if <code class="xref py py-func docutils literal notranslate"><span class="pre">Simulation.compute_pos_and_vel()</span></code> is not explicitly
invoked, <code class="xref py py-func docutils literal notranslate"><span class="pre">Simulation.add_dipole()</span></code> takes care of that internally initializing
<code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftOrbit</span></code> and computing positions and velocities.</p>
</section>
<section id="module-litebird_sim.spacecraft">
<span id="api-reference"></span><h2>API reference<a class="headerlink" href="#module-litebird_sim.spacecraft" title="Link to this heading">#</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">SpacecraftOrbit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">earth_l2_distance_km</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1496509.30522</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius1_km</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">244450.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius2_km</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">137388.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ang_speed1_rad_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4.0266897619299316e-07</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ang_speed2_rad_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">3.955023673808657e-07</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase_rad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-0.8367806565761614</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solar_velocity_km_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">369.816</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solar_velocity_gal_lat_rad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.842173724</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solar_velocity_gal_lon_rad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4.6080357444</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A dataclass describing the orbit of the LiteBIRD spacecraft</p>
<p>This structure has the following fields:</p>
<ul class="simple">
<li><p><cite>start_time</cite>: Date and time when the spacecraft starts its nominal orbit</p></li>
<li><p><cite>earth_l2_distance_km</cite>: distance between the Earth’s barycenter and the L2
point, in km</p></li>
<li><p><cite>radius1_km</cite>: first radius describing the Lissajous orbit followed by the
spacecraft, in km</p></li>
<li><p><cite>radius2_km</cite>: second radius describing the Lissajous orbit followed by the
spacecraft, in km</p></li>
<li><p><cite>ang_speed1_rad_s</cite>: first angular speed of the Lissajous orbit, in rad/s</p></li>
<li><p><cite>ang_speed2_rad_s</cite>: second angular speed of the Lissajous orbit, in rad/s</p></li>
<li><p><cite>phase_rad</cite>: phase difference between the two periodic motions in the Lissajous
orbit, in radians</p></li>
<li><p><cite>solar_velocity_km_s</cite>: velocity of the Sun as estimated from Planck 2018 Solar
dipole (see arxiv: 1807.06207)</p></li>
<li><p><cite>solar_velocity_gal_lat_rad</cite>: galactic latitude direction of the Planck 2018
Solar dipole</p></li>
<li><p><cite>solar_velocity_gal_lon_rad</cite>: galactic longitude direction of the Planck 2018
Solar dipole</p></li>
</ul>
<p>The default values are the nominal numbers of the orbit followed by WMAP, described
in Cavaluzzi, Fink &amp; Coyle (2008).</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.ang_speed1_rad_s">
<span class="sig-name descname"><span class="pre">ang_speed1_rad_s</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">4.0266897619299316e-07</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.ang_speed1_rad_s" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.ang_speed2_rad_s">
<span class="sig-name descname"><span class="pre">ang_speed2_rad_s</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3.955023673808657e-07</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.ang_speed2_rad_s" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.earth_l2_distance_km">
<span class="sig-name descname"><span class="pre">earth_l2_distance_km</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1496509.30522</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.earth_l2_distance_km" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.phase_rad">
<span class="sig-name descname"><span class="pre">phase_rad</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">-0.8367806565761614</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.phase_rad" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.radius1_km">
<span class="sig-name descname"><span class="pre">radius1_km</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">244450.0</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.radius1_km" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.radius2_km">
<span class="sig-name descname"><span class="pre">radius2_km</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">137388.0</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.radius2_km" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_ecl_xyz_km_s">
<span class="sig-name descname"><span class="pre">solar_velocity_ecl_xyz_km_s</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">array([-359.00346797,</span>&#160;&#160; <span class="pre">52.57540642,</span>&#160; <span class="pre">-71.52769031])</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_ecl_xyz_km_s" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_gal_lat_rad">
<span class="sig-name descname"><span class="pre">solar_velocity_gal_lat_rad</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.842173724</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_gal_lat_rad" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_gal_lon_rad">
<span class="sig-name descname"><span class="pre">solar_velocity_gal_lon_rad</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">4.6080357444</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_gal_lon_rad" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_km_s">
<span class="sig-name descname"><span class="pre">solar_velocity_km_s</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">369.816</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_km_s" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftOrbit.start_time">
<span class="sig-name descname"><span class="pre">start_time</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Time</span></em><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftOrbit.start_time" title="Link to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftPositionAndVelocity">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">SpacecraftPositionAndVelocity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orbit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftOrbit" title="litebird_sim.spacecraft.SpacecraftOrbit"><span class="pre">SpacecraftOrbit</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_span_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positions_km</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">velocities_km_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Encode the position/velocity of the spacecraft with respect to the Solar System</p>
<p>This class contains information that characterize the motion of the spacecraft.
It is mainly useful to simulate the so-called CMB «orbital dipole» and to properly
check the visibility of the Sun, the Moon and inner planets.  The coordinate
system used by this class is the standard Barycentric Ecliptic reference frame.</p>
<p>The fields of this class are the following:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">orbit</span></code>: a <a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftOrbit" title="litebird_sim.spacecraft.SpacecraftOrbit"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftOrbit</span></code></a> object used to compute the positions and</dt><dd><p>velocities in this object;</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">start_time</span></code>: the time when the nominal orbit started (a <code class="docutils literal notranslate"><span class="pre">astropy.time.Time</span></code></dt><dd><p>object);</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">time_span_s</span></code>: the time span covered by this object, in seconds;</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">positions_km</span></code>: a <code class="docutils literal notranslate"><span class="pre">N×3</span></code> matrix, representing a list of <code class="docutils literal notranslate"><span class="pre">N</span></code> XYZ vectors</dt><dd><p>encoding the position of the spacecraft in the Barycentric
Ecliptic reference frame (in kilometers);</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">velocities_km_s</span></code>: a <code class="docutils literal notranslate"><span class="pre">N×3</span></code> matrix, representing a list of <code class="docutils literal notranslate"><span class="pre">N</span></code> XYZ vectors</dt><dd><p>encoding the linear velocity of the spacecraft in the
Barycentric Ecliptic reference frame (in km/s).</p>
</dd>
</dl>
</li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.SpacecraftPositionAndVelocity.compute_velocities">
<span class="sig-name descname"><span class="pre">compute_velocities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time0</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta_time_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_of_samples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity.compute_velocities" title="Link to this definition">#</a></dt>
<dd><p>Perform a linear interpolation to sample the satellite velocity in time</p>
<p>Return a N×3 array containing a set of <cite>num_of_samples</cite> 3D vectors with the
velocity of the spacecraft (in km/s) computed every <cite>delta_time_s</cite> seconds
starting from time <cite>time0</cite>.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.compute_l2_pos_and_vel">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">compute_l2_pos_and_vel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time0</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">earth_l2_distance_km</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1496509.30522</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.spacecraft.compute_l2_pos_and_vel" title="Link to this definition">#</a></dt>
<dd><p>Compute the position and velocity of the L2 Sun-Earth point at a given time.</p>
<p>The L2 point is not calculated using Lagrange’s equations; instead, its
distance from the Earth must be provided as the parameter <cite>earth_l2_distance_km</cite>.
The default value is a reasonable estimate. The L2 point is assumed to lie along
the line that connects the Solar System Barycenter with the Earth’s gravitational
center.</p>
<p>The return value is a 2-tuple containing two NumPy arrays:</p>
<ol class="arabic simple">
<li><p>A 3D array containing the XYZ components of the vector specifying the position
of the L2 point, in km</p></li>
<li><p>A 3D array containing the XYZ components of the velocity vector of the L2 point,
in km/s</p></li>
</ol>
<p>The two vectors are always roughly perpendicular, but they are not exactly due to
the irregular motion of the Earth (caused by gravitational interactions with other
Solar System bodies, like the Moon and Jupiter).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.compute_lissajous_pos_and_vel">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">compute_lissajous_pos_and_vel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">earth_angle_rad</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">earth_ang_speed_rad_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius1_km</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius2_km</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ang_speed1_rad_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ang_speed2_rad_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase_rad</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.spacecraft.compute_lissajous_pos_and_vel" title="Link to this definition">#</a></dt>
<dd><p>Compute the position and velocity of the spacecraft assuming a Lissajous orbit</p>
<p>The position and velocity are calculated in a reference frame centered on the L2
point, whose axes are aligned with the Solar System Barycenter. This means that
the position and velocity of the spacecraft with respect to the Solar System
Barycenter itself can be calculated by summing the result of this function with
the result of a call to <a class="reference internal" href="#litebird_sim.spacecraft.compute_l2_pos_and_vel" title="litebird_sim.spacecraft.compute_l2_pos_and_vel"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_l2_pos_and_vel()</span></code></a>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.compute_start_and_span_for_obs">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">compute_start_and_span_for_obs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">observations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Time</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#litebird_sim.spacecraft.compute_start_and_span_for_obs" title="Link to this definition">#</a></dt>
<dd><p>Compute the start time and the overall duration in seconds of a set of observations.</p>
<p>The code returns the earliest start time of the observations in <cite>observations</cite> as
well as their overall time span. Gaps between observations are neglected.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.cycles_per_year_to_rad_per_s">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">cycles_per_year_to_rad_per_s</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#litebird_sim.spacecraft.cycles_per_year_to_rad_per_s" title="Link to this definition">#</a></dt>
<dd><p>Convert an angular speed from cycles/yr to rad/s</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.get_ecliptic_vec">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">get_ecliptic_vec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.spacecraft.get_ecliptic_vec" title="Link to this definition">#</a></dt>
<dd><p>Convert a coordinate in a XYZ vector expressed in the Ecliptic rest frame</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.spacecraft_pos_and_vel">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">spacecraft_pos_and_vel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orbit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftOrbit" title="litebird_sim.spacecraft.SpacecraftOrbit"><span class="pre">SpacecraftOrbit</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">observations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Time</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_span_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta_time_s</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">86400.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity" title="litebird_sim.spacecraft.SpacecraftPositionAndVelocity"><span class="pre">SpacecraftPositionAndVelocity</span></a></span></span><a class="headerlink" href="#litebird_sim.spacecraft.spacecraft_pos_and_vel" title="Link to this definition">#</a></dt>
<dd><p>Compute the position and velocity of the L2 point within some time span</p>
<p>This function computes the XYZ position and velocity of the second Sun-Earth
Lagrangean point (L2) over a time span specified either by a
<a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> object/list of objects, or by an explicit pair of values
<cite>start_time</cite> (an <code class="docutils literal notranslate"><span class="pre">astropy.time.Time</span></code> object) and <cite>time_span_s</cite> (length in
seconds). The position is specified in the standard Barycentric Ecliptic
reference frame.</p>
<p>The position of the L2 point is computed starting from the position of the
Earth and moving away along the anti-Sun direction by a number of kilometers
equal to <cite>earth_l2_distance_km</cite>.</p>
<p>The result is an object of type <a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity" title="litebird_sim.spacecraft.SpacecraftPositionAndVelocity"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftPositionAndVelocity</span></code></a>.</p>
<p>If SpacecraftOrbit.solar_velocity_km_s &gt; 0 also the Sun velocity in the rest
frame of the CMB is added to the total velocity of the spacecraft.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.spacecraft.sum_lissajous_pos_and_vel">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.spacecraft.</span></span><span class="sig-name descname"><span class="pre">sum_lissajous_pos_and_vel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_time_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius1_km</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius2_km</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ang_speed1_rad_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ang_speed2_rad_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase_rad</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.spacecraft.sum_lissajous_pos_and_vel" title="Link to this definition">#</a></dt>
<dd><p>Add the position and velocity of a Lissajous orbit to some positions/velocities</p>
<p>The <cite>pos</cite> and <cite>vel</cite> arrays must have the same shape (N×3, with N being the number
of position-velocity pairs); the 3D position and velocity of the Lissajous orbit
will be added to these arrays.</p>
<p>The <cite>times</cite> array must be an array of <em>float</em> values, typically starting from zero,
and they must measure the time in seconds. All the other parameters are usually
taken from a <a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftOrbit" title="litebird_sim.spacecraft.SpacecraftOrbit"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpacecraftOrbit</span></code></a> object.</p>
<p>This function has no return value, as the result is stored in <cite>pos</cite> and <cite>vel</cite>.</p>
</dd></dl>

<dl class="py class" id="module-litebird_sim.dipole">
<dt class="sig sig-object py" id="litebird_sim.dipole.DipoleType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">DipoleType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.DipoleType" title="Link to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">IntEnum</span></code></p>
<p>Approximation for the Doppler shift caused by the motion of the spacecraft</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.dipole.DipoleType.LINEAR">
<span class="sig-name descname"><span class="pre">LINEAR</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#litebird_sim.dipole.DipoleType.LINEAR" title="Link to this definition">#</a></dt>
<dd><p>Linear approximation in β using thermodynamic units:</p>
<div class="math notranslate nohighlight">
\[\Delta T(\vec\beta, \hat n) = T_0 \vec\beta\cdot\hat n\]</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.dipole.DipoleType.QUADRATIC_EXACT">
<span class="sig-name descname"><span class="pre">QUADRATIC_EXACT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#litebird_sim.dipole.DipoleType.QUADRATIC_EXACT" title="Link to this definition">#</a></dt>
<dd><p>Second-order approximation in β using thermodynamic units:</p>
<div class="math notranslate nohighlight">
\[\Delta T(\vec\beta, \hat n) = T_0\left(\vec\beta\cdot\hat n +
\bigl(\vec\beta\cdot\hat n\bigr)^2\right)\]</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.dipole.DipoleType.QUADRATIC_FROM_LIN_T">
<span class="sig-name descname"><span class="pre">QUADRATIC_FROM_LIN_T</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3</span></em><a class="headerlink" href="#litebird_sim.dipole.DipoleType.QUADRATIC_FROM_LIN_T" title="Link to this definition">#</a></dt>
<dd><p>Second-order approximation in β using linearized units:</p>
<div class="math notranslate nohighlight">
\[\Delta_2 T(\nu) = T_0 \left(\vec\beta\cdot\hat n + q(x)
\bigl(\vec\beta\cdot\hat n\bigr)^2\right)\]</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.dipole.DipoleType.TOTAL_EXACT">
<span class="sig-name descname"><span class="pre">TOTAL_EXACT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#litebird_sim.dipole.DipoleType.TOTAL_EXACT" title="Link to this definition">#</a></dt>
<dd><p>Exact formula in true thermodynamic units:</p>
<div class="math notranslate nohighlight">
\[\frac{T_0}{\gamma \bigl(1 - \vec\beta \cdot \hat n\bigr)}\]</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="litebird_sim.dipole.DipoleType.TOTAL_FROM_LIN_T">
<span class="sig-name descname"><span class="pre">TOTAL_FROM_LIN_T</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">4</span></em><a class="headerlink" href="#litebird_sim.dipole.DipoleType.TOTAL_FROM_LIN_T" title="Link to this definition">#</a></dt>
<dd><p>Full formula in linearized units (the most widely used):</p>
<div class="math notranslate nohighlight">
\[\Delta T = \frac{T_0}{f(x)} \left(\frac{\mathrm{BB}\left(T_0 /
\gamma\bigl(1 - \vec\beta\cdot\hat n\bigr)\right)}{\mathrm{BB}(T_0)}
- 1\right) = \frac{T_0}{f(x)} \left(\frac{\mathrm{BB}\bigl(\nu
\gamma(1-\vec\beta\cdot\hat n), T_0\bigr)}{\bigl(\gamma(1-
\vec\beta\cdot\hat n)\bigr)^3\mathrm{BB}(t_0)}\right).\]</div>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.add_dipole">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">add_dipole</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointings</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">velocity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_cmb_k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frequency_ghz</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dipole_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.dipole.DipoleType" title="litebird_sim.dipole.DipoleType"><span class="pre">DipoleType</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.add_dipole" title="Link to this definition">#</a></dt>
<dd><p>Add the CMB dipole to some time-ordered data</p>
<p>This functions modifies the values in <cite>tod</cite> by adding the contribution of the
CMB dipole. Use <cite>dipole_type</cite> to specify which kind of approximation to use
for the dipole component. The <cite>pointings</cite> argument must be a N×3 matrix containing
the pointing information, where N is the size of the <cite>tod</cite> array. The <cite>velocity</cite>
argument is usually computed through <a class="reference internal" href="#litebird_sim.spacecraft.spacecraft_pos_and_vel" title="litebird_sim.spacecraft.spacecraft_pos_and_vel"><code class="xref py py-func docutils literal notranslate"><span class="pre">spacecraft_pos_and_vel()</span></code></a>. Finally,
<cite>t_cmb_k</cite> is the temperature of the monopole and <cite>frequency_ghz</cite> is an array
containing the frequencies of each detector in the TOD.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.add_dipole_for_one_detector">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">add_dipole_for_one_detector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tod_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theta_phi_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">velocity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_cmb_k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nu_hz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f_x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dipole_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.dipole.DipoleType" title="litebird_sim.dipole.DipoleType"><span class="pre">DipoleType</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.add_dipole_for_one_detector" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.add_dipole_to_observations">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">add_dipole_to_observations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">observations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><span class="pre">Observation</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos_and_vel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity" title="litebird_sim.spacecraft.SpacecraftPositionAndVelocity"><span class="pre">SpacecraftPositionAndVelocity</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">pointings</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_cmb_k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2.72548</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dipole_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#litebird_sim.dipole.DipoleType" title="litebird_sim.dipole.DipoleType"><span class="pre">DipoleType</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">DipoleType.TOTAL_FROM_LIN_T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frequency_ghz</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">None</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'tod'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.add_dipole_to_observations" title="Link to this definition">#</a></dt>
<dd><p>Add the CMB dipole to some time-ordered data</p>
<p>This is a wrapper around the <a class="reference internal" href="#litebird_sim.dipole.add_dipole" title="litebird_sim.dipole.add_dipole"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_dipole()</span></code></a> function that applies to the TOD
stored in <cite>observations</cite>, which can either be one <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> instance
or a list of observations.</p>
<p>By default, the TOD is added to <code class="docutils literal notranslate"><span class="pre">Observation.tod</span></code>. If you want to add it to some
other field of the <a class="reference internal" href="observations.html#litebird_sim.observations.Observation" title="litebird_sim.observations.Observation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Observation</span></code></a> class, use <cite>component</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cur_obs</span> <span class="ow">in</span> <span class="n">sim</span><span class="o">.</span><span class="n">observations</span><span class="p">:</span>
    <span class="c1"># Allocate a new TOD for the dipole alone</span>
    <span class="n">cur_obs</span><span class="o">.</span><span class="n">dipole_tod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">cur_obs</span><span class="o">.</span><span class="n">tod</span><span class="p">)</span>

<span class="c1"># Ask `add_dipole_to_observations` to store the dipole</span>
<span class="c1"># in `observations.dipole_tod`</span>
<span class="n">add_dipole_to_observations</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">observations</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s2">&quot;dipole_tod&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.calculate_beta">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">calculate_beta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v_km_s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.calculate_beta" title="Link to this definition">#</a></dt>
<dd><p>Return a 2-tuple containing β·n and β</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.compute_dipole_for_one_sample_linear">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">compute_dipole_for_one_sample_linear</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v_km_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_cmb_k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.compute_dipole_for_one_sample_linear" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.compute_dipole_for_one_sample_quadratic_exact">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">compute_dipole_for_one_sample_quadratic_exact</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v_km_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_cmb_k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.compute_dipole_for_one_sample_quadratic_exact" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.compute_dipole_for_one_sample_quadratic_from_lin_t">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">compute_dipole_for_one_sample_quadratic_from_lin_t</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v_km_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_cmb_k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.compute_dipole_for_one_sample_quadratic_from_lin_t" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.compute_dipole_for_one_sample_total_exact">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">compute_dipole_for_one_sample_total_exact</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v_km_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_cmb_k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.compute_dipole_for_one_sample_total_exact" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.compute_dipole_for_one_sample_total_from_lin_t">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">compute_dipole_for_one_sample_total_from_lin_t</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v_km_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_cmb_k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nu_hz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f_x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">planck_t0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.compute_dipole_for_one_sample_total_from_lin_t" title="Link to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.compute_scalar_product">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">compute_scalar_product</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.compute_scalar_product" title="Link to this definition">#</a></dt>
<dd><p>Return the scalar (dot) product between a given direction and a velocity</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="litebird_sim.dipole.planck">
<span class="sig-prename descclassname"><span class="pre">litebird_sim.dipole.</span></span><span class="sig-name descname"><span class="pre">planck</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nu_hz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.dipole.planck" title="Link to this definition">#</a></dt>
<dd><p>Return occupation number at frequency nu_hz and temperature t_k</p>
</dd></dl>

</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="sky_maps.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Synthetic sky maps</p>
      </div>
    </a>
    <a class="right-next"
       href="map_scanning.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Scanning a map to fill a TOD</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#position-and-velocity-of-the-spacecraft">Position and velocity of the spacecraft</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-the-dipole">Computing the dipole</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods-of-class-simulation">Methods of class simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-litebird_sim.spacecraft">API reference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.ang_speed1_rad_s"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.ang_speed1_rad_s</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.ang_speed2_rad_s"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.ang_speed2_rad_s</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.earth_l2_distance_km"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.earth_l2_distance_km</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.phase_rad"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.phase_rad</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.radius1_km"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.radius1_km</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.radius2_km"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.radius2_km</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_ecl_xyz_km_s"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.solar_velocity_ecl_xyz_km_s</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_gal_lat_rad"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.solar_velocity_gal_lat_rad</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_gal_lon_rad"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.solar_velocity_gal_lon_rad</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.solar_velocity_km_s"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.solar_velocity_km_s</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftOrbit.start_time"><code class="docutils literal notranslate"><span class="pre">SpacecraftOrbit.start_time</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity"><code class="docutils literal notranslate"><span class="pre">SpacecraftPositionAndVelocity</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.SpacecraftPositionAndVelocity.compute_velocities"><code class="docutils literal notranslate"><span class="pre">SpacecraftPositionAndVelocity.compute_velocities()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.compute_l2_pos_and_vel"><code class="docutils literal notranslate"><span class="pre">compute_l2_pos_and_vel()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.compute_lissajous_pos_and_vel"><code class="docutils literal notranslate"><span class="pre">compute_lissajous_pos_and_vel()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.compute_start_and_span_for_obs"><code class="docutils literal notranslate"><span class="pre">compute_start_and_span_for_obs()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.cycles_per_year_to_rad_per_s"><code class="docutils literal notranslate"><span class="pre">cycles_per_year_to_rad_per_s()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.get_ecliptic_vec"><code class="docutils literal notranslate"><span class="pre">get_ecliptic_vec()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.spacecraft_pos_and_vel"><code class="docutils literal notranslate"><span class="pre">spacecraft_pos_and_vel()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.spacecraft.sum_lissajous_pos_and_vel"><code class="docutils literal notranslate"><span class="pre">sum_lissajous_pos_and_vel()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.DipoleType"><code class="docutils literal notranslate"><span class="pre">DipoleType</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.DipoleType.LINEAR"><code class="docutils literal notranslate"><span class="pre">DipoleType.LINEAR</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.DipoleType.QUADRATIC_EXACT"><code class="docutils literal notranslate"><span class="pre">DipoleType.QUADRATIC_EXACT</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.DipoleType.QUADRATIC_FROM_LIN_T"><code class="docutils literal notranslate"><span class="pre">DipoleType.QUADRATIC_FROM_LIN_T</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.DipoleType.TOTAL_EXACT"><code class="docutils literal notranslate"><span class="pre">DipoleType.TOTAL_EXACT</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.DipoleType.TOTAL_FROM_LIN_T"><code class="docutils literal notranslate"><span class="pre">DipoleType.TOTAL_FROM_LIN_T</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.add_dipole"><code class="docutils literal notranslate"><span class="pre">add_dipole()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.add_dipole_for_one_detector"><code class="docutils literal notranslate"><span class="pre">add_dipole_for_one_detector()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.add_dipole_to_observations"><code class="docutils literal notranslate"><span class="pre">add_dipole_to_observations()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.calculate_beta"><code class="docutils literal notranslate"><span class="pre">calculate_beta()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.compute_dipole_for_one_sample_linear"><code class="docutils literal notranslate"><span class="pre">compute_dipole_for_one_sample_linear()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.compute_dipole_for_one_sample_quadratic_exact"><code class="docutils literal notranslate"><span class="pre">compute_dipole_for_one_sample_quadratic_exact()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.compute_dipole_for_one_sample_quadratic_from_lin_t"><code class="docutils literal notranslate"><span class="pre">compute_dipole_for_one_sample_quadratic_from_lin_t()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.compute_dipole_for_one_sample_total_exact"><code class="docutils literal notranslate"><span class="pre">compute_dipole_for_one_sample_total_exact()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.compute_dipole_for_one_sample_total_from_lin_t"><code class="docutils literal notranslate"><span class="pre">compute_dipole_for_one_sample_total_from_lin_t()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.compute_scalar_product"><code class="docutils literal notranslate"><span class="pre">compute_scalar_product()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#litebird_sim.dipole.planck"><code class="docutils literal notranslate"><span class="pre">planck()</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/dipole.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2020, The LiteBIRD Simulation Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>